import{a as z,j as e}from"./query-CQB1N7mz.js";import{b as Y,r as c}from"./vendor-D5cPNHfC.js";import{m as J,O as X,q as Z,w as k,P as h}from"./index-DrAcGZG1.js";import"./supabase-Br6iVc9W.js";const E={urgent:{label:"Urgente",color:"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400",dot:"bg-red-500"},high:{label:"Alta",color:"bg-orange-100 dark:bg-orange-900/20 text-orange-700 dark:text-orange-400",dot:"bg-orange-500"},medium:{label:"Media",color:"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400",dot:"bg-yellow-400"},low:{label:"Baixa",color:"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",dot:"bg-slate-400"}},ee=[{id:"todo",title:"Por Fazer",color:"from-slate-400 to-slate-500",emptyText:"Nenhuma O.S. pendente"},{id:"doing",title:"Em Andamento",color:"from-blue-500 to-blue-600",emptyText:"Nenhuma O.S. em andamento"},{id:"done",title:"Concluido",color:"from-green-500 to-emerald-600",emptyText:"Nenhuma O.S. concluida"}];function v(x){return x?new Date(x).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}):"-"}function R(x){return(x||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function ne(){const x=Y(),u=z(),{data:m=[],isLoading:L}=J(),{data:P=[],isLoading:q}=X(),[M,I]=c.useState({}),[T,B]=c.useState(!0),[Q,N]=c.useState(null),[y,b]=c.useState(""),[j,g]=c.useState(""),[w,f]=c.useState("1");c.useEffect(()=>{Z().then(s=>{I(s),B(!1)})},[]);const F=L||q||T,i=M.name||"",d=c.useMemo(()=>{if(!i)return{todo:[],doing:[],done:[]};const s=m.filter(a=>k(a.assignedTo,i)&&a.status==="available"),r=m.filter(a=>k(a.assignee,i)&&a.status==="in_progress"),t=m.filter(a=>k(a.assignee,i)&&a.status==="done");return{todo:s,doing:r,done:t}},[m,i]),O=c.useMemo(()=>{const s={urgent:0,high:1,medium:2,low:3},r=[...d.todo,...d.doing].sort((a,o)=>{const n=s[a.priority]??9,l=s[o.priority]??9;return n!==l?n-l:(a.sortOrder??0)-(o.sortOrder??0)}),t={};return r.forEach((a,o)=>{t[a.id]=o+1}),t},[d]),D=async s=>{var n;const r=new Date().toISOString(),t=m.find(l=>l.id===s);let a={};if(((n=t==null?void 0:t.checklist)==null?void 0:n.length)>0){const l=t.checklist.findIndex(p=>!p.done);l>=0&&(a={checklist:t.checklist.map((p,$)=>$===l?{...p,startedAt:r}:p)})}await h(s,{assignee:i,status:"in_progress",actualStart:r,...a})&&u.invalidateQueries({queryKey:["osOrders"]})},K=async s=>{const r=new Date().toISOString();await h(s,{status:"done",actualEnd:r})&&u.invalidateQueries({queryKey:["osOrders"]})},W=async s=>{await h(s,{status:"in_progress",actualEnd:""})&&u.invalidateQueries({queryKey:["osOrders"]})},_=async s=>{const r=y.trim(),t=parseFloat(j)||0,a=parseInt(w)||1;if(!r||t<=0)return;const o=m.find(p=>p.id===s);if(!o)return;const n=[...o.expenses||[],{name:r,value:t,quantity:a}];await h(s,{expenses:n})&&u.invalidateQueries({queryKey:["osOrders"]}),b(""),g(""),f("1")},A=async(s,r)=>{const t=m.find(n=>n.id===s);if(!t)return;const a=(t.expenses||[]).filter((n,l)=>l!==r);await h(s,{expenses:a})&&u.invalidateQueries({queryKey:["osOrders"]})},G=s=>!s||s.length===0?0:s.reduce((r,t)=>r+(t.value||0)*(t.quantity||1),0),H=s=>{var r;return((r=P.find(t=>t.id===s))==null?void 0:r.name)||null};if(F)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})});const S={urgent:0,high:1,medium:2,low:3},C=(s,r)=>{const t=S[s.priority]??9,a=S[r.priority]??9;return t!==a?t-a:(s.sortOrder??0)-(r.sortOrder??0)},U={todo:[...d.todo].sort(C),doing:[...d.doing].sort(C),done:d.done},V=d.todo.length+d.doing.length+d.done.length;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Minha Rotina"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:i?e.jsxs(e.Fragment,{children:["O.S. atribuidas a ",e.jsx("strong",{className:"text-slate-700 dark:text-slate-200",children:i})," â€” ",V," no total"]}):"Configure seu nome nas Configuracoes para ver suas O.S."})]})}),i?e.jsx("div",{className:"flex-1 grid grid-cols-3 gap-4 min-h-0",children:ee.map(s=>{const r=U[s.id];return e.jsxs("div",{className:"flex flex-col min-h-0",children:[e.jsxs("div",{className:`bg-gradient-to-r ${s.color} rounded-t-xl px-4 py-2.5 flex items-center justify-between`,children:[e.jsx("h3",{className:"text-sm font-bold text-white",children:s.title}),e.jsx("span",{className:"bg-white/20 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:r.length})]}),e.jsxs("div",{className:"flex-1 bg-slate-50 dark:bg-slate-900 rounded-b-xl p-3 space-y-2.5 overflow-y-auto border border-t-0 border-slate-200 dark:border-slate-700",children:[r.length===0&&e.jsx("div",{className:"flex items-center justify-center h-32 text-slate-400 dark:text-slate-500 text-sm italic",children:s.emptyText}),r.map(t=>{const a=E[t.priority]||E.medium,o=H(t.projectId);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-3 hover:shadow-md hover:border-fyness-primary/30 transition-all group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[O[t.id]&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 rounded-full bg-fyness-primary text-white text-[10px] font-bold shrink-0",children:O[t.id]}),e.jsxs("span",{className:"text-xs font-bold text-slate-400 dark:text-slate-500",children:["O.S. #",t.number]})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 text-[10px] font-medium px-1.5 py-0.5 rounded-full ${a.color}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${a.dot}`}),a.label]})]}),e.jsx("h4",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100 mb-1",children:t.title}),o&&e.jsx("p",{className:"text-[11px] text-blue-500 font-medium mb-0.5",children:o}),t.client&&e.jsx("p",{className:"text-[11px] text-slate-400 dark:text-slate-500",children:t.client}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-[10px] text-slate-400 dark:text-slate-500",children:[t.estimatedStart&&e.jsxs("span",{children:["Prev: ",v(t.estimatedStart)]}),t.actualStart&&e.jsxs("span",{className:"text-green-500",children:["Inicio: ",v(t.actualStart)]}),t.actualEnd&&e.jsxs("span",{className:"text-emerald-600",children:["Fim: ",v(t.actualEnd)]})]}),(s.id==="doing"||s.id==="done")&&e.jsxs("div",{className:"mt-2",children:[t.expenses&&t.expenses.length>0&&e.jsxs("div",{className:"mb-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide",children:"Gastos"}),e.jsx("span",{className:"text-[10px] font-bold text-amber-600",children:R(G(t.expenses))})]}),e.jsx("div",{className:"space-y-0.5",children:t.expenses.map((n,l)=>e.jsxs("div",{className:"flex items-center justify-between text-[10px] bg-amber-50 dark:bg-amber-900/20 rounded px-1.5 py-0.5 group/exp",children:[e.jsxs("span",{className:"text-slate-600 dark:text-slate-300 truncate mr-1",children:[n.quantity>1&&e.jsxs("span",{className:"font-medium text-slate-500 dark:text-slate-400",children:[n.quantity,"x "]}),n.name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-amber-700",children:R(n.value*(n.quantity||1))}),s.id==="doing"&&e.jsx("button",{onClick:()=>A(t.id,l),className:"opacity-0 group-hover/exp:opacity-100 text-red-400 hover:text-red-600 transition-opacity ml-0.5",title:"Remover gasto",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},l))})]}),s.id==="doing"&&e.jsx(e.Fragment,{children:Q===t.id?e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-lg p-2 border border-slate-200 dark:border-slate-700 space-y-1.5",children:[e.jsx("input",{type:"text",value:y,onChange:n=>b(n.target.value),placeholder:"Material/Ferramenta",className:"w-full px-2 py-1 text-xs border border-slate-200 dark:border-slate-600 rounded focus:ring-1 focus:ring-amber-400 focus:border-amber-400 dark:bg-slate-800 dark:text-slate-200 dark:placeholder-slate-500"}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("input",{type:"number",value:j,onChange:n=>g(n.target.value),placeholder:"Valor (R$)",min:"0",step:"0.01",className:"flex-1 px-2 py-1 text-xs border border-slate-200 dark:border-slate-600 rounded focus:ring-1 focus:ring-amber-400 focus:border-amber-400 dark:bg-slate-800 dark:text-slate-200 dark:placeholder-slate-500"}),e.jsx("input",{type:"number",value:w,onChange:n=>f(n.target.value),placeholder:"Qtd",min:"1",className:"w-14 px-2 py-1 text-xs border border-slate-200 dark:border-slate-600 rounded focus:ring-1 focus:ring-amber-400 focus:border-amber-400 dark:bg-slate-800 dark:text-slate-200 dark:placeholder-slate-500"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>_(t.id),disabled:!y.trim()||!j,className:"flex-1 py-1 bg-amber-500 text-white text-[10px] rounded hover:bg-amber-600 transition-colors font-medium disabled:opacity-40 disabled:cursor-not-allowed",children:"Adicionar"}),e.jsx("button",{onClick:()=>{N(null),b(""),g(""),f("1")},className:"px-2 py-1 border border-slate-200 dark:border-slate-600 text-slate-500 dark:text-slate-400 text-[10px] rounded hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:"Cancelar"})]})]}):e.jsxs("button",{onClick:()=>{N(t.id),b(""),g(""),f("1")},className:"w-full py-1 border border-dashed border-amber-300 dark:border-amber-600 text-amber-600 dark:text-amber-400 text-[10px] rounded-lg hover:bg-amber-50 dark:hover:bg-amber-900/20 hover:border-amber-400 transition-colors font-medium flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Registrar Gasto"]})})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-slate-100 dark:border-slate-700 flex items-center gap-2",children:[s.id==="todo"&&e.jsx("button",{onClick:()=>D(t.id),className:"flex-1 py-1.5 bg-fyness-primary text-white text-xs rounded-lg hover:bg-fyness-secondary transition-colors font-medium",children:"Pegar O.S."}),s.id==="doing"&&e.jsx("button",{onClick:()=>K(t.id),className:"flex-1 py-1.5 bg-green-500 text-white text-xs rounded-lg hover:bg-green-600 transition-colors font-medium",children:"Concluir"}),s.id==="done"&&e.jsx("button",{onClick:()=>W(t.id),className:"flex-1 py-1.5 border border-slate-300 dark:border-slate-600 text-slate-600 dark:text-slate-300 text-xs rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors font-medium",children:"Reabrir"}),e.jsx("button",{onClick:()=>x("/financial"),className:"px-2 py-1.5 border border-slate-200 dark:border-slate-700 text-slate-400 dark:text-slate-500 text-xs rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:"Ver no Kanban",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})]},t.id)})]})]},s.id)})}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-slate-400 dark:text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Perfil nao configurado"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"Preencha seu nome nas Configuracoes para ver suas O.S."}),e.jsx("button",{onClick:()=>x("/settings"),className:"px-4 py-2 bg-fyness-primary text-white rounded-lg hover:bg-fyness-secondary transition-colors text-sm font-medium",children:"Ir para Configuracoes"})]})})]})}export{ne as RoutinePage,ne as default};
