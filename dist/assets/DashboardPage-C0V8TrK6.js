import{j as e}from"./query-CQB1N7mz.js";import{r as y,L as le}from"./vendor-D5cPNHfC.js";import{j as oe,k as ie,m as de,n as ce,o as xe,p as me,q as he,r as ue,s as pe,t as R,v as ge,w as H,x as q,y as V,z as je,A as Q,B as G,C as Y,D,E as ve,F as be,G as fe,H as ke,I as Ne,J as ye,K as Me,L as we,M as $e,N as Ce}from"./index-DrAcGZG1.js";import"./supabase-Br6iVc9W.js";function Le({data:l=[],color:r="#3b82f6",width:h=80,height:d=24}){if(l.length<2)return null;const u=l.map(f=>typeof f=="number"?f:f.value),o=Math.min(...u),i=Math.max(...u)-o||1,p=u.map((f,s)=>{const b=s/(u.length-1)*h,S=d-(f-o)/i*(d-4)-2;return`${b},${S}`});return e.jsx("svg",{width:h,height:d,className:"inline-block",children:e.jsx("polyline",{fill:"none",stroke:r,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",points:p.join(" ")})})}function F({label:l,value:r,suffix:h="",trend:d=0,trendInverted:u=!1,sparklineData:o=[],color:v="#3b82f6"}){const i=u?d<0:d>0,p=u?d>0:d<0,f=i?"text-emerald-600 dark:text-emerald-400":p?"text-red-500 dark:text-red-400":"text-slate-400 dark:text-slate-500",s=d>0?"↑":d<0?"↓":"→";return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:l}),o.length>=2&&e.jsx(Le,{data:o,color:v})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:[r,h]}),d!==0&&e.jsxs("span",{className:`text-xs font-medium ${f} mb-1`,children:[s," ",Math.abs(d).toFixed(1),h]})]})]})}function Te({history:l=[]}){if(l.length<3)return null;const h=[{key:"completionRate",label:"Taxa de conclusao",suffix:"%",good:"up"},{key:"onTimeRate",label:"Entrega no prazo",suffix:"%",good:"up"},{key:"productivity",label:"Produtividade",suffix:"%",good:"up"},{key:"hoursMonth",label:"Horas/mes",suffix:"h",good:"up"},{key:"avgDelivery",label:"Tempo medio de entrega",suffix:" dias",good:"down"}].map(i=>{const p=oe(l,i.key);return p?{...i,...p}:null}).filter(Boolean).filter(i=>Math.abs(i.trend)>.1);if(h.length===0)return null;const d=h[0];d.good===d.direction||d.good==="down"&&d.direction;const u=new Date,o=new Date(u.getFullYear(),u.getMonth()+1,1),v=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-5",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-violet-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Projecao para ",ie(v)]}),e.jsx("div",{className:"space-y-3",children:h.slice(0,4).map(i=>{const p=i.good==="up"?i.direction==="up":i.direction==="down";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:i.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-slate-800 dark:text-slate-100",children:[i.nextMonth.toFixed(1),i.suffix]}),e.jsxs("span",{className:`text-xs font-medium ${p?"text-emerald-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"}`,children:[i.direction==="up"?"↑":"↓"," ",Math.abs(i.trend).toFixed(1)]})]})]},i.key)})}),e.jsxs("p",{className:"text-[11px] text-slate-400 dark:text-slate-500 mt-3",children:["Baseado na media dos ultimos ",Math.min(l.length,6)," meses"]})]})}const te=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),se=()=>e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:2}),e.jsx("circle",{cx:"12",cy:"12",r:"6",strokeWidth:2}),e.jsx("circle",{cx:"12",cy:"12",r:"2",strokeWidth:2})]}),ae=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),ne=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),Ae=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),Re=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),re=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),Se=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),De=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),K=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})});function L({title:l,value:r,subtitle:h,icon:d,color:u="blue",trend:o,trendLabel:v}){const i={blue:"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",green:"bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400",orange:"bg-orange-50 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400",purple:"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",red:"bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400",amber:"bg-amber-50 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400"};return e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 shadow-sm border border-slate-200 dark:border-slate-700 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:l}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 dark:text-slate-100 mt-1",children:r}),h&&e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:h}),o!==void 0&&o!==0&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-xs font-medium ${o>0?"text-emerald-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"}`,children:[o>0?e.jsx("span",{children:"▲"}):e.jsx("span",{children:"▼"}),e.jsxs("span",{children:[Math.abs(o),"% ",v||"vs mes anterior"]})]})]}),d&&e.jsx("div",{className:`p-2.5 rounded-lg shrink-0 ${i[u]}`,children:e.jsx(d,{})})]})})}function P({title:l,action:r,children:h}){return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-100 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:l}),r&&e.jsx(le,{to:r.href,className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:r.label})]}),h]})}function X({message:l}){return e.jsxs("div",{className:"px-5 py-10 text-center",children:[e.jsx("svg",{className:"w-10 h-10 text-slate-200 dark:text-slate-600 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-sm text-slate-400 dark:text-slate-500",children:l})]})}function U({value:l,max:r=100,label:h,color:d="#3b82f6",size:u=120}){const o=Math.min(Math.max(l/r,0),1),v=o*180,i=(u-16)/2,p=u/2,f=u/2+4,s=p-i,b=f,S=Math.PI*v/180,T=p-i*Math.cos(S),I=f-i*Math.sin(S),n=v>180?1:0;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{width:u,height:u/2+16,viewBox:`0 0 ${u} ${u/2+16}`,children:[e.jsx("path",{d:`M ${p-i} ${f} A ${i} ${i} 0 0 1 ${p+i} ${f}`,fill:"none",stroke:"#e2e8f0",strokeWidth:"8",strokeLinecap:"round"}),o>0&&e.jsx("path",{d:`M ${s} ${b} A ${i} ${i} 0 ${n} 1 ${T} ${I}`,fill:"none",stroke:d,strokeWidth:"8",strokeLinecap:"round"}),e.jsxs("text",{x:p,y:f-8,textAnchor:"middle",className:"text-lg font-bold",fill:"#1e293b",fontSize:"18",children:[l,typeof r=="number"&&r<=100?"%":""]})]}),h&&e.jsx("p",{className:"text-xs text-slate-500 mt-1 text-center",children:h})]})}function B({label:l,value:r,maxValue:h,color:d,suffix:u=""}){const o=h>0?Math.min(r/h*100,100):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:l}),e.jsxs("span",{className:"text-slate-500 dark:text-slate-400 font-medium",children:[r,u]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${o}%`,backgroundColor:d}})})]})}function ee({profile:l,currentUser:r,orders:h,events:d}){var I;const u=new Date,o=l.hoursMonth||176,[v,i]=y.useState([]),p=y.useMemo(()=>((r.name||"").toLowerCase().trim(),h.filter(n=>n.assignee===r.id||H(n.assignee,r.name)||H(n.assignedTo,r.name))),[h,r]),f=y.useMemo(()=>d.filter(n=>n.assignee===r.id),[d,r]),s=y.useMemo(()=>q(p,f,o),[p,f,o]);y.useEffect(()=>{(async()=>{const n=r.name||l.name||"";if(!n)return;await ye(p,f,o,n);const g=await Me(n);i(g)})()},[r,p,f,o,l]);const b=y.useMemo(()=>we(v),[v]),S=y.useMemo(()=>p.filter(n=>n.status==="in_progress"&&n.actualStart).map(n=>{const g=Math.floor((Date.now()-new Date(n.actualStart).getTime())/864e5);return{...n,daysRunning:g}}).sort((n,g)=>g.daysRunning-n.daysRunning).slice(0,5),[p]),T=y.useMemo(()=>{const n=[];for(let g=5;g>=0;g--){const E=new Date(u.getFullYear(),u.getMonth()-g,1),a=p.filter(x=>{if(x.status!=="done"||!x.actualEnd)return!1;const m=new Date(x.actualEnd);return m.getMonth()===E.getMonth()&&m.getFullYear()===E.getFullYear()}),t=a.reduce((x,m)=>x+$e(m),0),c=a.reduce((x,m)=>x+Ce(m),0),k=t>0?Math.round(c/t*100):0;n.push({label:E.toLocaleDateString("pt-BR",{month:"short"}).replace(".",""),productivity:k,done:a.length})}return n},[p]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["Ola, ",((I=l==null?void 0:l.name)==null?void 0:I.split(" ")[0])||r.name,"!"]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[u.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," — Meus KPIs"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(L,{title:"Tempo Medio de Entrega",value:`${s.avgDeliveryMonth} dias`,subtitle:`Geral: ${s.avgDelivery} dias`,icon:ae,color:"blue"}),e.jsx(L,{title:"Taxa de Conclusao",value:`${s.completionRate}%`,subtitle:`${s.doneMonth} de ${s.doneMonth+s.inProgress} no mes`,icon:ne,color:"green"}),e.jsx(L,{title:"Entrega no Prazo",value:`${s.onTimeRate}%`,subtitle:s.avgDelay>0?`Atraso medio: ${s.avgDelay} dias`:"Sem atrasos",icon:se,color:parseInt(s.onTimeRate)>=80?"green":"orange"}),e.jsx(L,{title:"Produtividade",value:`${s.productivityMonth}%`,subtitle:`${s.estimatedHours.toFixed(0)}h prev. / ${s.realizedHours.toFixed(0)}h realiz.`,icon:te,color:parseInt(s.productivityMonth)>=90?"green":parseInt(s.productivityMonth)>=60?"purple":"orange",trend:parseInt(s.productivityChange)}),e.jsx(L,{title:"Reunioes",value:`${s.meetingAttendance}% presenca`,subtitle:`${s.meetingPunctuality}% no horario · ${s.attendedMeetings} de ${s.pastMeetings}`,icon:K,color:parseInt(s.meetingAttendance)>=80?"green":parseInt(s.meetingAttendance)>=60?"amber":"red"}),e.jsx(L,{title:"Atrasos",value:Y(s.totalLateMinutes),subtitle:s.lateArrivals===0?"Nenhum atraso registrado":`${s.lateArrivals} ocorrencia${s.lateArrivals>1?"s":""} em ${s.attendedMeetings} reunioes`,icon:re,color:s.lateArrivals===0?"green":s.lateArrivals<=2?"amber":"red"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-5",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100 mb-4",children:"Indicadores"}),e.jsxs("div",{className:"flex items-center justify-around",children:[e.jsx(U,{value:parseInt(s.reworkRate),label:"Retrabalho",color:parseInt(s.reworkRate)<=15?"#22c55e":parseInt(s.reworkRate)<=30?"#f97316":"#ef4444"}),e.jsx(U,{value:parseInt(s.utilization),label:"Aproveitamento",color:parseInt(s.utilization)>=70?"#3b82f6":"#ef4444"})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-5 lg:col-span-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:"Evolucao de Produtividade"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"Produtividade"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-[1px] bg-emerald-400",style:{borderTop:"1px dashed #34d399"}}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"Meta 100%"})]})]})]}),(()=>{const m=T,M=Math.max(...m.map(N=>N.productivity),120),w=0,$=m.map((N,C)=>({x:36+C/(m.length-1)*448,y:148-(N.productivity-w)/(M-w)*124,val:N.productivity,label:N.label,done:N.done})),z=$.reduce((N,C,_)=>{if(_===0)return`M ${C.x} ${C.y}`;const J=$[_-1],Z=(J.x+C.x)/2;return`${N} C ${Z} ${J.y}, ${Z} ${C.y}, ${C.x} ${C.y}`},""),O=`${z} L ${$[$.length-1].x} 148 L ${$[0].x} 148 Z`,j=148-(100-w)/(M-w)*124,A=[0,50,100],W=$[$.length-1];return e.jsxs("svg",{viewBox:"0 0 500 180",className:"w-full",preserveAspectRatio:"xMidYMid meet",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"prodGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.02"})]}),e.jsxs("filter",{id:"glow",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),A.map(N=>{const C=148-(N-w)/(M-w)*124;return e.jsxs("g",{children:[e.jsx("line",{x1:36,y1:C,x2:484,y2:C,stroke:"#e2e8f0",strokeWidth:"0.5"}),e.jsxs("text",{x:30,y:C+4,textAnchor:"end",fill:"#94a3b8",fontSize:"10",children:[N,"%"]})]},N)}),e.jsx("line",{x1:36,y1:j,x2:484,y2:j,stroke:"#34d399",strokeWidth:"1.2",strokeDasharray:"6 4",opacity:"0.7"}),e.jsx("path",{d:O,fill:"url(#prodGradient)"}),e.jsx("path",{d:z,fill:"none",stroke:"#3b82f6",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",filter:"url(#glow)"}),$.map((N,C)=>e.jsx("text",{x:N.x,y:172,textAnchor:"middle",fill:"#94a3b8",fontSize:"10",className:"capitalize",children:N.label},C)),$.map((N,C)=>e.jsxs("g",{children:[e.jsx("circle",{cx:N.x,cy:N.y,r:"5",fill:"white",stroke:"#3b82f6",strokeWidth:"2.5"}),e.jsxs("text",{x:N.x,y:N.y-10,textAnchor:"middle",fill:N.val>=90?"#059669":N.val>=60?"#2563eb":"#ea580c",fontSize:"10",fontWeight:"bold",children:[N.val,"%"]})]},C)),e.jsx("circle",{cx:W.x,cy:W.y,r:"6",fill:"#3b82f6",stroke:"white",strokeWidth:"2.5",filter:"url(#glow)"})]})})()]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(P,{title:"O.S. Em Andamento (Monitoramento)",action:{label:"Ver O.S.",href:"/financial"},children:S.length===0?e.jsx(X,{message:"Nenhuma O.S. em andamento"}):e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:S.map(n=>{const g=n.estimatedEnd&&new Date(n.estimatedEnd)<u;return e.jsx("div",{className:"px-5 py-3 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono text-slate-400 dark:text-slate-500",children:["#",n.number]}),e.jsx("span",{className:"text-sm font-medium text-slate-800 dark:text-slate-100 truncate",children:n.title}),g&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-red-100 text-red-600 font-medium shrink-0",children:"Atrasada"})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:n.client||"Sem cliente"})]}),e.jsxs("div",{className:"text-right shrink-0 ml-3",children:[e.jsxs("span",{className:`text-xs font-bold ${n.daysRunning>7?"text-red-600":n.daysRunning>3?"text-amber-600":"text-slate-700"}`,children:[n.daysRunning," dias"]}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"em andamento"})]})]})},n.id)})})}),e.jsx(P,{title:"Resumo de Carga",children:e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-700/50",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-400 dark:text-slate-300",children:s.available}),e.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-1",children:"Disponiveis"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:s.inProgress}),e.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-1",children:"Em Andamento"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-emerald-50 dark:bg-emerald-900/20",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:s.doneMonth}),e.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-1",children:"Concluidas"})]})]}),e.jsxs("div",{className:"pt-2 space-y-3",children:[e.jsx(B,{label:"Utilizacao",value:parseInt(s.utilization),maxValue:100,color:"#3b82f6",suffix:"%"}),e.jsx(B,{label:"Meta de Horas",value:s.hoursMonth.toFixed(0),maxValue:o,color:"#22c55e",suffix:`h / ${o}h`})]}),parseInt(s.onTimeRate)<70&&e.jsx("div",{className:"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-100",children:e.jsxs("p",{className:"text-xs text-amber-700 flex items-start gap-2",children:[e.jsx("span",{className:"shrink-0 mt-0.5",children:"⚠"}),"Sua taxa de pontualidade esta em ",s.onTimeRate,"%. Tente priorizar as O.S. com prazo mais proximo."]})}),parseInt(s.utilization)<50&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-100",children:e.jsxs("p",{className:"text-xs text-blue-700 flex items-start gap-2",children:[e.jsx("span",{className:"shrink-0 mt-0.5",children:"ℹ"}),"Sua utilizacao esta em ",s.utilization,"%. Verifique se ha O.S. disponiveis para pegar."]})})]})})]}),v.length>=2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(Ae,{})," Tendencias"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(F,{label:"Taxa de Conclusao",value:parseFloat(s.completionRate),suffix:"%",trend:b.completionRate,sparklineData:v.map(n=>{var g;return((g=n.metrics)==null?void 0:g.completionRate)||0}),color:"#22c55e"}),e.jsx(F,{label:"Entrega no Prazo",value:parseFloat(s.onTimeRate),suffix:"%",trend:b.onTimeRate,sparklineData:v.map(n=>{var g;return((g=n.metrics)==null?void 0:g.onTimeRate)||0}),color:"#3b82f6"}),e.jsx(F,{label:"Produtividade",value:parseFloat(s.productivityMonth),suffix:"%",trend:b.productivity,sparklineData:v.map(n=>{var g;return((g=n.metrics)==null?void 0:g.productivity)||0}),color:"#3b82f6"}),e.jsx(F,{label:"Horas/Mes",value:s.hoursMonth,suffix:"h",trend:b.hoursMonth,sparklineData:v.map(n=>{var g;return((g=n.metrics)==null?void 0:g.hoursMonth)||0}),color:"#f59e0b"})]}),e.jsx(Te,{history:v})]})]})}function Ie({profile:l,orders:r,events:h,selectedMember:d,onMemberChange:u,allMembers:o}){var E;const v=new Date,i=l.hoursMonth||176,p=y.useMemo(()=>{if(d==="all")return r;const a=o.find(t=>t.id===d);return a?r.filter(t=>t.assignee===d||H(a.name,t.assignee)||H(a.name,t.assignedTo)):r},[r,d,o]),f=y.useMemo(()=>d==="all"?h:h.filter(a=>a.assignee===d),[h,d]),s=y.useMemo(()=>q(p,f,i),[p,f,i]),b=y.useMemo(()=>o.map(a=>{const t=r.filter(x=>x.assignee===a.id||H(a.name,x.assignee)||H(a.name,x.assignedTo)),c=h.filter(x=>x.assignee===a.id),k=q(t,c,i);return{member:a,kpi:k}}),[r,h,i,o]),S=y.useMemo(()=>[...b].sort((a,t)=>t.kpi.doneMonth-a.kpi.doneMonth||t.kpi.hoursMonth-a.kpi.hoursMonth),[b]),T=y.useMemo(()=>{const a=r.filter(j=>j.status==="done"&&V(j.actualEnd)),t=r.filter(j=>j.status==="done"&&je(j.actualEnd)),c=a.map(j=>Q(j,o)),k=t.map(j=>Q(j,o)),x=c.reduce((j,A)=>j+A.totalCost,0),m=c.reduce((j,A)=>j+A.laborCost,0),M=c.reduce((j,A)=>j+A.materialCost,0),w=c.length>0?x/c.length:0,$=k.reduce((j,A)=>j+A.totalCost,0),z=k.length>0?$/k.length:0,O=z>0?(w-z)/z*100:0;return{totalCostMonth:x,totalLaborMonth:m,totalMaterialMonth:M,avgCostMonth:w,costChange:O,countMonth:c.length}},[r,o]),I=y.useMemo(()=>{const a=h.filter(x=>x.type==="meeting"&&V(x.startDate)),t=a.map(x=>{const m=new Date(x.startDate),M=new Date(x.endDate),w=Math.max((M-m)/36e5,0),z=(x.attendees&&x.attendees.length>0?x.attendees:x.assignee?[x.assignee]:[]).reduce((O,j)=>{const A=o.find(W=>W.id===j||H(W.name,j));return O+(A?G(A):0)},0);return w*z}),c=t.reduce((x,m)=>x+m,0),k=t.length>0?c/t.length:0;return{total:c,avg:k,count:a.length}},[h,o]),n=y.useMemo(()=>{const a=[];return r.filter(t=>t.status==="done"&&t.actualEnd).forEach(t=>{const k=o.find(x=>x.id===t.assignee||H(x.name,t.assignee))||(t.assignee?{id:t.assignee,name:t.assignee,color:"#3b82f6"}:null);k&&a.push({date:t.actualEnd,desc:`${R(k.name)} concluiu O.S. #${t.number}`,member:k})}),a.sort((t,c)=>new Date(c.date)-new Date(t.date)).slice(0,6)},[r,o]),g=["text-amber-500","text-slate-400","text-orange-600"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start sm:items-center justify-between flex-col sm:flex-row gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["Ola, ",((E=l==null?void 0:l.name)==null?void 0:E.split(" ")[0])||"Gestor","!"]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[v.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," — KPIs da Equipe"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400",children:"Filtrar:"}),e.jsxs("select",{value:d,onChange:a=>u(a.target.value),className:"px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-800 dark:text-slate-200",children:[e.jsx("option",{value:"all",children:"Toda a equipe"}),o.map(a=>e.jsx("option",{value:a.id,children:R(a.name)},a.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(L,{title:"Tempo Medio Entrega",value:`${s.avgDeliveryMonth} dias`,subtitle:`Geral: ${s.avgDelivery} dias`,icon:ae,color:"blue"}),e.jsx(L,{title:"Taxa de Conclusao",value:`${s.completionRate}%`,subtitle:`${s.doneMonth} no mes`,icon:ne,color:"green"}),e.jsx(L,{title:"Entrega no Prazo",value:`${s.onTimeRate}%`,subtitle:s.avgDelay>0?`Atraso medio: ${s.avgDelay}d`:"Sem atrasos",icon:se,color:parseInt(s.onTimeRate)>=80?"green":"red"}),e.jsx(L,{title:"Produtividade",value:`${s.productivityMonth}%`,subtitle:`${s.estimatedHours.toFixed(0)}h prev. / ${s.realizedHours.toFixed(0)}h realiz.`,icon:te,color:parseInt(s.productivityMonth)>=90?"green":parseInt(s.productivityMonth)>=60?"purple":"orange",trend:parseInt(s.productivityChange)}),e.jsx(L,{title:"Aproveitamento de Horas",value:`${s.utilization}%`,subtitle:`${s.hoursMonth.toFixed(0)}h de ${i}h`,icon:Se,color:parseInt(s.utilization)>=70?"green":"orange"}),e.jsx(L,{title:"Reunioes",value:`${s.meetingAttendance}% presenca`,subtitle:`${s.meetingPunctuality}% no horario · ${s.attendedMeetings} de ${s.pastMeetings}`,icon:K,color:parseInt(s.meetingAttendance)>=80?"green":parseInt(s.meetingAttendance)>=60?"amber":"red"}),e.jsx(L,{title:"Atrasos",value:Y(s.totalLateMinutes),subtitle:s.lateArrivals===0?"Nenhum atraso registrado":`${s.lateArrivals} ocorrencia${s.lateArrivals>1?"s":""} em ${s.attendedMeetings} reunioes`,icon:re,color:s.lateArrivals===0?"green":s.lateArrivals<=2?"amber":"red"}),e.jsx(L,{title:"Custo Medio / O.S.",value:D(T.avgCostMonth),subtitle:`Total: ${D(T.totalCostMonth)} (${T.countMonth} O.S.)`,icon:De,color:"orange",trend:T.costChange!==0?Math.round(-T.costChange):void 0,trendLabel:"vs mes anterior"}),e.jsx(L,{title:"Custo Medio / Reuniao",value:D(I.avg),subtitle:`Total: ${D(I.total)} (${I.count} reunioes)`,icon:K,color:"purple"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100 mb-3 flex items-center gap-2",children:[e.jsx(Re,{})," Performance da Equipe"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:b.map(({member:a,kpi:t})=>{const c=parseInt(t.onTimeRate),k=parseInt(t.utilization);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm",style:{backgroundColor:a.color},children:a.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:R(a.name)}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:[t.productivityMonth,"% produtividade"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:t.doneMonth}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"Concl. (mes)"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-lg font-bold ${c>=80?"text-emerald-600":c>=50?"text-amber-600":"text-red-600"}`,children:[t.onTimeRate,"%"]}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"No prazo"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-bold ${parseInt(t.meetingAttendance)>=80?"text-blue-600":"text-amber-600"}`,children:[t.meetingAttendance,"%"]}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"Reunioes"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-bold ${t.lateArrivals===0?"text-emerald-600":t.lateArrivals<=2?"text-amber-600":"text-red-600"}`,children:Y(t.totalLateMinutes)}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"Atrasos"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:e.jsx("div",{className:"flex justify-between text-[10px] text-slate-400 mb-0.5",children:e.jsxs("span",{children:["Tempo medio: ",t.avgDeliveryMonth,"d"]})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-400 mb-0.5",children:[e.jsx("span",{children:"Aproveitamento"}),e.jsxs("span",{children:[t.utilization,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{backgroundColor:a.color,width:`${k}%`}})})]})]})]},a.id)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(P,{title:"Ranking do Mes",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 dark:bg-slate-700/50",children:[e.jsx("th",{className:"text-left px-5 py-2.5 text-[10px] font-semibold text-slate-400 dark:text-slate-500 uppercase w-10",children:"#"}),e.jsx("th",{className:"text-left px-3 py-2.5 text-[10px] font-semibold text-slate-400 dark:text-slate-500 uppercase",children:"Colaborador"}),e.jsx("th",{className:"text-center px-3 py-2.5 text-[10px] font-semibold text-slate-400 dark:text-slate-500 uppercase",children:"O.S."}),e.jsx("th",{className:"text-center px-3 py-2.5 text-[10px] font-semibold text-slate-400 dark:text-slate-500 uppercase",children:"Prazo"}),e.jsx("th",{className:"text-center px-5 py-2.5 text-[10px] font-semibold text-slate-400 dark:text-slate-500 uppercase",children:"T.Medio"})]})}),e.jsx("tbody",{children:S.map((a,t)=>e.jsxs("tr",{className:"border-t border-slate-100 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-5 py-3",children:t<3?e.jsx("span",{className:`font-bold ${g[t]}`,children:t+1}):e.jsx("span",{className:"text-slate-400",children:t+1})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:a.member.color},children:a.member.name.charAt(0)}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:R(a.member.name)})]})}),e.jsx("td",{className:"px-3 py-3 text-center font-bold text-slate-800 dark:text-slate-100",children:a.kpi.doneMonth}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsxs("span",{className:`text-xs font-bold ${parseInt(a.kpi.onTimeRate)>=80?"text-emerald-600":"text-red-500"}`,children:[a.kpi.onTimeRate,"%"]})}),e.jsxs("td",{className:"px-5 py-3 text-center font-bold text-blue-600",children:[a.kpi.avgDeliveryMonth,"d"]})]},a.member.id))})]})})}),e.jsx(P,{title:"Analise de Entregas",children:e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-3",children:"Tempo Medio de Entrega (dias)"}),e.jsx("div",{className:"space-y-3",children:b.map(({member:a,kpi:t})=>e.jsx(B,{label:R(a.name),value:parseFloat(t.avgDeliveryMonth),maxValue:Math.max(...b.map(c=>parseFloat(c.kpi.avgDeliveryMonth)),1),color:a.color,suffix:" dias"},a.id))})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-100 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-3",children:"Taxa de Pontualidade (%)"}),e.jsx("div",{className:"space-y-3",children:b.map(({member:a,kpi:t})=>e.jsx(B,{label:R(a.name),value:parseInt(t.onTimeRate),maxValue:100,color:parseInt(t.onTimeRate)>=80?"#22c55e":parseInt(t.onTimeRate)>=50?"#f97316":"#ef4444",suffix:"%"},a.id))})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(P,{title:"Capacidade da Equipe",children:e.jsx("div",{className:"p-5 space-y-3",children:ve(r,o).map(t=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-[10px] font-bold",style:{backgroundColor:t.color},children:t.name.charAt(0)}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:R(t.name)})]}),e.jsxs("span",{className:`text-xs font-bold ${t.utilization>100?"text-red-500":t.utilization>80?"text-amber-500":"text-emerald-500"}`,children:[t.utilization,"%"]})]}),e.jsx("div",{className:"h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${t.utilization>100?"bg-red-500":t.utilization>80?"bg-amber-400":"bg-emerald-400"}`,style:{width:`${Math.min(t.utilization,100)}%`}})}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:[t.allocatedHours.toFixed(1),"h alocadas / ",t.availableHours,"h disponivel · ",t.activeOrders," O.S. ativas"]})]},t.id))})}),e.jsx(P,{title:"Indicadores SaaS",children:e.jsx("div",{className:"p-5 space-y-4",children:(()=>{const a=be(r),t=fe(r),c=ke(r),k=Object.entries(c).filter(([,M])=>M.total>0),x={bug:"Bug",feature:"Feature",support:"Suporte",compliance:"Compliance",campaign:"Campanha",internal:"Interno"},m={bug:"#ef4444",feature:"#3b82f6",support:"#22c55e",compliance:"#a855f7",campaign:"#f59e0b",internal:"#64748b"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:a<24?`${Math.round(a)}h`:`${Math.round(a/24)}d`}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"Lead Time Medio"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center",children:[e.jsxs("p",{className:`text-2xl font-bold ${t.rate>=80?"text-emerald-600":t.rate>=50?"text-amber-500":"text-red-500"}`,children:[t.rate,"%"]}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-1",children:["SLA Cumprido (",t.met,"/",t.total,")"]})]})]}),k.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Por Categoria"}),k.map(([M,w])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:m[M]}}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:x[M]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-400",children:[e.jsxs("span",{children:[w.done,"/",w.total]}),e.jsxs("span",{children:[w.inProgress," ativas"]})]})]},M))]})]})})()})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(P,{title:"Custo por Colaborador (Mes)",children:o.some(a=>G(a)>0)?e.jsxs("div",{className:"p-5 space-y-3",children:[b.map(({member:a,kpi:t})=>{const c=G(a),k=t.hoursMonth*c,m=r.filter($=>$.status==="done"&&V($.actualEnd)&&($.assignee||"").toLowerCase().trim()===a.name.toLowerCase().trim()).reduce(($,z)=>$+(z.expenses||[]).reduce((O,j)=>O+(j.value||0)*(j.quantity||1),0),0),M=k+m,w=t.doneMonth>0?M/t.doneMonth:0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:a.color},children:a.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:R(a.name)}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:[c>0?`${D(c)}/h`:"Sem salario"," · ",t.hoursMonth.toFixed(0),"h · ",t.doneMonth," O.S."]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-slate-100",children:D(M)}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:[w>0?`${D(w)}/O.S.`:"-",m>0?` · Mat: ${D(m)}`:""]})]})]},a.id)}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:"Total do Mes"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:D(T.totalCostMonth)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] text-slate-400 dark:text-slate-500",children:[e.jsxs("span",{children:["Mao de obra: ",D(T.totalLaborMonth)]}),e.jsxs("span",{children:["Materiais: ",D(T.totalMaterialMonth)]})]})]})]}):e.jsx(X,{message:"Configure salario dos funcionarios em Configuracoes > Equipe"})}),e.jsx(P,{title:"Atividade Recente",children:n.length===0?e.jsx(X,{message:"Nenhuma atividade recente"}):e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-700 max-h-80 overflow-y-auto",children:n.map((a,t)=>e.jsxs("div",{className:"px-5 py-3 flex items-start gap-3 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold shrink-0 mt-0.5",style:{backgroundColor:a.member.color},children:a.member.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-200 leading-tight",children:a.desc}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:Ne(a.date)})]})]},t))})})]}),function(){const a=[];return b.forEach(({member:t,kpi:c})=>{parseInt(c.onTimeRate)<50&&c.totalDone>0&&a.push({type:"warning",msg:`${R(t.name)} esta com ${c.onTimeRate}% de pontualidade. Considere revisar a carga.`}),c.inProgress>5&&a.push({type:"info",msg:`${R(t.name)} tem ${c.inProgress} O.S. em andamento simultaneamente.`})}),a.length===0?null:e.jsx("div",{className:"space-y-2",children:a.map((t,c)=>e.jsxs("div",{className:`p-3 rounded-lg border flex items-start gap-2 text-xs ${t.type==="warning"?"bg-amber-50 border-amber-100 text-amber-700":"bg-blue-50 border-blue-100 text-blue-700"}`,children:[e.jsx("span",{className:"shrink-0 mt-0.5",children:t.type==="warning"?"⚠":"ℹ"}),t.msg]},c))})}()]})}function Oe(){var x;const[l,r]=y.useState({}),[h,d]=y.useState("all"),{data:u=[],isLoading:o}=de(),{data:v=[],isLoading:i}=ce(),{data:p=[],isLoading:f}=xe(),s=o||i||f;me(),y.useEffect(()=>{he().then(r);const m=()=>r(ge());return window.addEventListener("storage",m),window.addEventListener("profile-updated",m),()=>{window.removeEventListener("storage",m),window.removeEventListener("profile-updated",m)}},[]);const b=y.useMemo(()=>!l.name||p.some(M=>M.name.toLowerCase().trim()===l.name.toLowerCase().trim())?p:[{id:"profile_self",name:l.name,role:l.role||"",color:"#3b82f6"},...p],[p,l]),S=y.useMemo(()=>ue(l),[l]),[T,I]=y.useState(null),n=T||S,g=y.useMemo(()=>pe(l,b),[l,b]);if(s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})});const E=()=>{I(n==="manager"?"collaborator":"manager")},a=e.jsx("div",{className:"flex items-center justify-end mb-4",children:e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-3 py-1.5 text-xs font-medium rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 transition-colors shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:n==="manager"?"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z":"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),n==="manager"?"Ver como Colaborador":"Ver como Gestor"]})}),t=n==="manager"&&h!=="all",c=t?b.find(m=>m.id===h)||b[0]:g,k=n==="manager"?e.jsxs("div",{className:"flex items-start sm:items-center justify-between flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["Ola, ",((x=l==null?void 0:l.name)==null?void 0:x.split(" ")[0])||"Gestor","!"]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[new Date().toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),t?` — Visualizando: ${R(c.name)}`:" — KPIs da Equipe"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400",children:"Filtrar:"}),e.jsxs("select",{value:h,onChange:m=>d(m.target.value),className:"px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-800 dark:text-slate-200",children:[e.jsx("option",{value:"all",children:"Toda a equipe"}),b.map(m=>e.jsx("option",{value:m.id,children:R(m.name)},m.id))]})]})]}):null;return n==="manager"&&!t?e.jsxs(e.Fragment,{children:[a,e.jsx(Ie,{profile:l,orders:u,events:v,selectedMember:h,onMemberChange:d,allMembers:b})]}):t?e.jsxs(e.Fragment,{children:[a,k,e.jsx(ee,{profile:l,currentUser:c,orders:u,events:v})]}):e.jsxs(e.Fragment,{children:[a,e.jsx(ee,{profile:l,currentUser:g,orders:u,events:v})]})}export{Oe as DashboardPage,Oe as default};
