import{j as e,a as Re}from"./query-CQB1N7mz.js";import{r as n}from"./vendor-D5cPNHfC.js";import{ap as Qe,an as ze,aq as Je,ar as Ee,as as et,at as tt,au as st,av as rt,aw as ke,$ as nt,Z as ge,ax as at,ay as ot,az as Se,aA as Ce,aB as Oe,aC as lt,aD as it,P as dt,aE as ct,aF as ut,o as ft,m as ht,aG as xt,aH as mt,aI as pt,aJ as bt,q as gt}from"./index-P8Mr3XGt.js";import"./supabase-Br6iVc9W.js";const yt=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),kt=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})}),jt=()=>e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l4 10-4 10-4-10z"})}),wt=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Dt=()=>e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4v16"})]}),vt=()=>e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5l-7 7 7 7"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 4v16"})]}),Nt=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),Mt=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),St=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),Ct=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})}),$t=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})}),It=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 4h6M9 8h6M9 12h6M9 16h6M9 20h6"})}),Lt=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),Tt=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4H4m0 0l5 5m6-5h5v5m0-5l-5 5M9 15v5H4m0 0l5-5m6 5h5v-5m0 5l-5-5"})}),Et=[{key:"rowNumber",label:"#"},{key:"wbsNumber",label:"WBS"},{key:"durationDays",label:"Duracao"},{key:"estimatedHours",label:"Horas"},{key:"startDate",label:"Inicio"},{key:"endDate",label:"Termino"},{key:"predecessors",label:"Predecessoras"},{key:"assignedTo",label:"Responsavel"},{key:"notes",label:"Notas"},{key:"progress",label:"% Progresso"}];function ae({onClick:c,icon:s,label:g,disabled:m,active:v,danger:f}){return e.jsxs("button",{onClick:c,disabled:m,title:g,className:`
        flex items-center gap-1.5 px-2 py-1.5 rounded text-xs font-medium transition-colors
        ${v?"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-400":f?"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}
        ${m?"opacity-40 cursor-not-allowed":"cursor-pointer"}
      `,children:[s,e.jsx("span",{className:"hidden xl:inline",children:g})]})}function pe(){return e.jsx("div",{className:"w-px h-6 bg-slate-200 dark:bg-slate-700 mx-0.5"})}function Ot({hiddenColumns:c,onToggleColumn:s}){const[g,m]=n.useState(!1),v=n.useRef(null),f=n.useRef(null),[M,p]=n.useState({top:0,left:0});return n.useEffect(()=>{if(!g||!v.current)return;const a=v.current.getBoundingClientRect();p({top:a.bottom+4,left:a.left})},[g]),n.useEffect(()=>{if(!g)return;const a=H=>{var k,$;(k=v.current)!=null&&k.contains(H.target)||($=f.current)!=null&&$.contains(H.target)||m(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[g]),e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:v,children:e.jsx(ae,{onClick:()=>m(a=>!a),icon:e.jsx(It,{}),label:"Colunas",active:g})}),g&&e.jsx("div",{ref:f,className:"fixed bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-xl py-1 min-w-[160px]",style:{top:M.top,left:M.left,zIndex:9999},children:Et.map(a=>e.jsxs("label",{className:"flex items-center gap-2 px-3 py-1.5 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer text-xs text-slate-700 dark:text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:!c.has(a.key),onChange:()=>s(a.key),className:"rounded border-slate-300 dark:border-slate-600 text-blue-600 focus:ring-blue-500"}),a.label]},a.key))})]})}function Wt({zoom:c,onZoomChange:s,onAddTask:g,onAddSubTask:m,onAddMilestone:v,onDeleteTask:f,onIndent:M,onOutdent:p,showCriticalPath:a,onToggleCriticalPath:H,hasSelection:k,teamMembers:$,filterAssignee:B,onFilterAssignee:W,onGenerateOS:I,onSyncProgress:L,selectedTask:R,summaryIds:F,hiddenColumns:N,onToggleColumn:z,isFullscreen:j,onToggleFullscreen:E}){const P=["day","week","month"],_={day:"Dia",week:"Semana",month:"Mes"},b=P.indexOf(c),X=()=>{b>0&&s(P[b-1])},K=()=>{b<P.length-1&&s(P[b+1])};return e.jsxs("div",{className:"h-10 border-b border-slate-200 dark:border-slate-700 px-2 flex items-center gap-0.5 bg-slate-50 dark:bg-slate-800/50 flex-shrink-0 overflow-x-auto",children:[e.jsx(ae,{onClick:g,icon:e.jsx(yt,{}),label:"Tarefa"}),e.jsx(ae,{onClick:m,icon:e.jsx(kt,{}),label:"Subtarefa",disabled:!k}),e.jsx(ae,{onClick:v,icon:e.jsx(jt,{}),label:"Marco"}),e.jsx(pe,{}),e.jsx(ae,{onClick:M,icon:e.jsx(Dt,{}),label:"Indentar",disabled:!k}),e.jsx(ae,{onClick:p,icon:e.jsx(vt,{}),label:"Recuar",disabled:!k}),e.jsx(pe,{}),e.jsx(ae,{onClick:f,icon:e.jsx(wt,{}),label:"Excluir",disabled:!k,danger:!0}),e.jsx(pe,{}),e.jsx(ae,{onClick:X,icon:e.jsx(Ct,{}),label:"",disabled:b===0}),e.jsx("span",{className:"px-1.5 text-xs font-medium text-slate-600 dark:text-slate-400 min-w-[50px] text-center",children:_[c]}),e.jsx(ae,{onClick:K,icon:e.jsx($t,{}),label:"",disabled:b===P.length-1}),e.jsx(pe,{}),e.jsx(ae,{onClick:H,icon:e.jsx(Nt,{}),label:"Critico",active:a}),e.jsx(pe,{}),e.jsx(ae,{onClick:I,icon:e.jsx(Mt,{}),label:"Gerar OS",disabled:!k||R&&R.osOrderId||R&&R.level===0&&(F==null?void 0:F.has(R.id))}),e.jsx(ae,{onClick:L,icon:e.jsx(St,{}),label:"Sync"}),e.jsx(pe,{}),e.jsx(Ot,{hiddenColumns:N,onToggleColumn:z}),e.jsx(ae,{onClick:E,icon:j?e.jsx(Tt,{}):e.jsx(Lt,{}),label:j?"Sair":"Tela Cheia"}),e.jsx("div",{className:"flex-1"}),e.jsxs("select",{value:B,onChange:d=>W(d.target.value),className:"text-xs px-2 py-1 border border-slate-200 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Todos"}),$.map(d=>e.jsx("option",{value:d.name,children:d.name},d.id))]})]})}const Ft=({expanded:c})=>e.jsx("svg",{className:`w-3.5 h-3.5 transition-transform ${c?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),Ht=()=>e.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l4 10-4 10-4-10z"})});function be({value:c,field:s,taskId:g,isEditing:m,onStartEdit:v,onFinish:f,type:M="text",options:p,className:a="",displayValue:H}){const k=n.useRef(null),[$,B]=n.useState(c);n.useEffect(()=>{B(c)},[c]),n.useEffect(()=>{m&&k.current&&(k.current.focus(),M==="text"&&k.current.select())},[m,M]);const W=()=>{if($!==c){const L=M==="number"?parseInt($,10)||0:$;f(g,s,L)}else f(null)},I=L=>{L.key==="Enter"?(L.preventDefault(),W()):L.key==="Escape"&&(B(c),f(null))};return m?M==="select"&&p?e.jsx("select",{ref:k,value:$,onChange:L=>{B(L.target.value),f(g,s,L.target.value)},onBlur:W,className:"w-full h-full px-1 py-0 text-xs border border-blue-500 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none",children:p.map(L=>e.jsx("option",{value:L.value,children:L.label},L.value))}):e.jsx("input",{ref:k,type:M==="number"?"number":M==="datetime-local"?"datetime-local":M==="date"?"date":"text",value:$,onChange:L=>B(L.target.value),onBlur:W,onKeyDown:I,min:M==="number"?0:void 0,max:M==="number"&&s==="progress"?100:void 0,className:"w-full h-full px-1 py-0 text-xs border border-blue-500 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none"}):e.jsx("div",{className:`w-full h-full flex items-center px-1 cursor-text truncate ${a}`,onDoubleClick:()=>v({taskId:g,field:s}),children:H??c??""})}function We(c){return c==null||c===0||c===""?"":c<1?`${Math.round(c*60)}m`:`${parseFloat(c.toFixed(1))}h`}function Rt({value:c,taskId:s,onFinish:g}){const[m,v]=n.useState(!1),[f,M]=n.useState(c),p=n.useRef(null);return n.useEffect(()=>{M(c)},[c]),n.useEffect(()=>{m&&p.current&&p.current.focus()},[m]),m?e.jsx("input",{ref:p,type:"number",min:0,max:100,value:f,onChange:a=>M(a.target.value),onBlur:()=>{const a=Math.min(100,Math.max(0,parseInt(f,10)||0));a!==c&&g(s,"progress",a),v(!1)},onKeyDown:a=>{a.key==="Enter"&&a.target.blur(),a.key==="Escape"&&(M(c),v(!1))},className:"w-full h-full px-1 py-0 text-xs border border-blue-500 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none"}):e.jsxs("div",{className:"flex items-center gap-1 w-full px-1 cursor-pointer",onDoubleClick:()=>v(!0),children:[e.jsx("div",{className:"flex-1 bg-slate-200 dark:bg-slate-600 rounded-full h-2.5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-blue-500 transition-all",style:{width:`${c}%`}})}),e.jsxs("span",{className:"text-[11px] w-8 text-right",children:[c,"%"]})]})}const zt=2*1024*1024;function Bt({notes:c,attachments:s=[],taskId:g,onFinish:m}){const[v,f]=n.useState(!1),[M,p]=n.useState(c||""),[a,H]=n.useState(s),[k,$]=n.useState(""),[B,W]=n.useState(""),I=n.useRef(null),L=n.useRef(null),[R,F]=n.useState({top:0,left:0});n.useEffect(()=>{p(c||"")},[c]),n.useEffect(()=>{H(s)},[s]),n.useEffect(()=>{if(!v||!I.current)return;const b=I.current.getBoundingClientRect(),X=Math.min(b.left,window.innerWidth-310),K=b.bottom+4,d=window.innerHeight-400;F({top:Math.min(K,d),left:Math.max(8,X-100)})},[v]),n.useEffect(()=>{if(!v)return;const b=X=>{var K,d;(K=I.current)!=null&&K.contains(X.target)||(d=L.current)!=null&&d.contains(X.target)||N()};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[v,M,a]);const N=()=>{const b=M!==(c||""),X=JSON.stringify(a)!==JSON.stringify(s);b&&m(g,"notes",M),X&&m(g,"attachments",a),f(!1)},z=()=>{if(!k.trim())return;const b={id:`att_${Date.now()}`,type:"link",url:k.trim(),label:B.trim()||k.trim(),createdAt:new Date().toISOString()};H(X=>[...X,b]),$(""),W("")},j=b=>{var d;const X=(d=b.target.files)==null?void 0:d[0];if(!X)return;if(X.size>zt){alert("Arquivo muito grande (max 2MB)");return}const K=new FileReader;K.onload=Y=>{const A={id:`att_${Date.now()}`,type:"image",data:Y.target.result,label:X.name,createdAt:new Date().toISOString()};H(te=>[...te,A])},K.readAsDataURL(X),b.target.value=""},E=b=>{H(X=>X.filter(K=>K.id!==b))},P=!!(c&&c.trim())||s.length>0,_=s.length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:I,className:"flex items-center justify-center w-full h-full cursor-pointer relative",onDoubleClick:()=>f(!0),title:P?`${c||""}
${_} anexo(s)`:"Duplo clique para detalhes",children:[P?e.jsxs("svg",{className:"w-3.5 h-3.5 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h5v7h7v9H6z"}),e.jsx("path",{d:"M8 13h8v1H8zm0 3h5v1H8z"})]}):e.jsx("svg",{className:"w-3.5 h-3.5 text-slate-300 dark:text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),_>0&&e.jsx("span",{className:"absolute -top-1 -right-0.5 w-3.5 h-3.5 bg-blue-500 text-white text-[8px] font-bold rounded-full flex items-center justify-center",children:_})]}),v&&e.jsxs("div",{ref:L,className:"fixed bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-xl p-3 z-[9999] max-h-[380px] overflow-y-auto",style:{top:R.top,left:R.left,width:300},children:[e.jsx("div",{className:"text-[10px] font-semibold text-slate-500 dark:text-slate-400 mb-1 uppercase",children:"Notas"}),e.jsx("textarea",{value:M,onChange:b=>p(b.target.value),onKeyDown:b=>{b.key==="Escape"&&f(!1),b.key==="Enter"&&b.ctrlKey&&N()},rows:3,placeholder:"Descricao da tarefa...",className:"w-full text-xs border border-slate-200 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 p-2 resize-none focus:outline-none focus:ring-1 focus:ring-blue-500"}),a.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"text-[10px] font-semibold text-slate-500 dark:text-slate-400 mb-1 uppercase",children:["Anexos (",a.length,")"]}),e.jsx("div",{className:"space-y-1",children:a.map(b=>e.jsxs("div",{className:"flex items-center gap-2 p-1.5 rounded border border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-750 group",children:[b.type==="link"?e.jsx("svg",{className:"w-3.5 h-3.5 text-blue-500 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}):b.data&&b.data.startsWith("data:image")?e.jsx("img",{src:b.data,alt:b.label,className:"w-7 h-7 rounded object-cover shrink-0"}):e.jsx("svg",{className:"w-3.5 h-3.5 text-slate-400 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"text-[11px] text-slate-600 dark:text-slate-300 truncate flex-1",children:b.type==="link"?e.jsx("a",{href:b.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",onClick:X=>X.stopPropagation(),children:b.label}):b.label}),e.jsx("button",{onClick:()=>E(b.id),className:"opacity-0 group-hover:opacity-100 p-0.5 text-slate-400 hover:text-red-500 transition-opacity",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},b.id))})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-[10px] font-semibold text-slate-500 dark:text-slate-400 mb-1 uppercase",children:"Adicionar Link"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"url",value:k,onChange:b=>$(b.target.value),placeholder:"https://...",className:"flex-1 text-[11px] border border-slate-200 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500",onKeyDown:b=>{b.key==="Enter"&&z()}}),e.jsx("button",{onClick:z,className:"text-[10px] px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 shrink-0",children:"+"})]}),k&&e.jsx("input",{type:"text",value:B,onChange:b=>W(b.target.value),placeholder:"Nome do link (opcional)",className:"w-full mt-1 text-[11px] border border-slate-200 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500",onKeyDown:b=>{b.key==="Enter"&&z()}})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-[10px] font-semibold text-slate-500 dark:text-slate-400 mb-1 uppercase",children:"Upload Arquivo"}),e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded border border-dashed border-slate-300 dark:border-slate-600 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"Imagem ou arquivo (max 2MB)"}),e.jsx("input",{type:"file",accept:"image/*,.pdf,.doc,.docx",onChange:j,className:"hidden"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-slate-100 dark:border-slate-700",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"Ctrl+Enter para salvar"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>f(!1),className:"text-[10px] px-2 py-0.5 text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:"Cancelar"}),e.jsx("button",{onClick:N,className:"text-[10px] px-3 py-0.5 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Salvar"})]})]})]})]})}const At=8,Pt=[{key:"rowNumber",label:"#",width:28},{key:"wbsNumber",label:"WBS",width:42},{key:"name",label:"Nome da Tarefa",width:160,flex:!0},{key:"durationDays",label:"Dur.",width:45,type:"number"},{key:"estimatedHours",label:"Horas",width:50,type:"number"},{key:"startDate",label:"Inicio",width:110,type:"datetime-local"},{key:"endDate",label:"Termino",width:110,type:"datetime-local"},{key:"predecessors",label:"Pred.",width:58},{key:"assignedTo",label:"Resp.",width:80},{key:"notes",label:"Notas",width:60},{key:"progress",label:"%",width:50}],Kt=n.forwardRef(function({tasks:s,allTasks:g,summaryIds:m,collapsedIds:v,selectedTaskIds:f,editingCell:M,criticalIds:p,showCriticalPath:a,teamMembers:H,osMap:k,taskRowMap:$,hiddenColumns:B=new Set,rowHeight:W,onSelectTask:I,onDragSelect:L,onToggleCollapse:R,onEditCell:F,onCellChange:N,onScroll:z},j){const E=n.useRef(null),P=(d,Y)=>{d.button===0&&(d.target.closest("input, select, button")||(E.current={startIdx:Y}))},_=d=>{if(!E.current)return;const Y=Math.min(E.current.startIdx,d),A=Math.max(E.current.startIdx,d);if(Y!==A){const te=s.slice(Y,A+1).map(ie=>ie.id);L(te)}};n.useEffect(()=>{const d=()=>{E.current=null};return window.addEventListener("mouseup",d),()=>window.removeEventListener("mouseup",d)},[]);const b=Pt.filter(d=>!B.has(d.key)),X=d=>{if(!d)return"";const Y=new Date(d.includes("T")?d:d+"T00:00:00");if(isNaN(Y))return"";const A=String(Y.getDate()).padStart(2,"0"),te=String(Y.getMonth()+1).padStart(2,"0"),ie=String(Y.getFullYear()).slice(-2),re=String(Y.getHours()).padStart(2,"0"),S=String(Y.getMinutes()).padStart(2,"0");return`${A}/${te}/${ie} ${re}:${S}`},K=[{value:"",label:"(nenhum)"},...H.map(d=>({value:d.name,label:d.name}))];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center border-b border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-800 flex-shrink-0",style:{height:W*2},children:b.map(d=>e.jsx("div",{className:`flex items-center justify-center px-1 text-[11px] font-semibold text-slate-600 dark:text-slate-400 uppercase tracking-wide border-r border-slate-200 dark:border-slate-700 h-full overflow-hidden ${d.flex?"flex-1 min-w-0":"shrink-0"}`,style:d.flex?{minWidth:d.width}:{width:d.width},children:e.jsx("span",{className:"truncate",children:d.label})},d.key))}),e.jsx("div",{ref:j,className:"flex-1 overflow-y-auto overflow-x-hidden",onScroll:z,children:s.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-sm text-slate-400 dark:text-slate-500",children:"Nenhuma tarefa. Clique em + Tarefa para comecar."}):s.map((d,Y)=>{const A=m.has(d.id),te=v.has(d.id),ie=f.has(d.id),re=a&&p.has(d.id);return e.jsx("div",{className:`flex items-center border-b border-slate-100 dark:border-slate-800 transition-colors select-none ${ie?"bg-blue-50 dark:bg-blue-900/20":re?"bg-red-50/50 dark:bg-red-900/10":"hover:bg-slate-50 dark:hover:bg-slate-800/50"}`,style:{height:W},onClick:S=>I(d.id,S),onMouseDown:S=>P(S,Y),onMouseEnter:()=>_(Y),children:b.map(S=>{const oe=(M==null?void 0:M.taskId)===d.id&&(M==null?void 0:M.field)===S.key;if(S.key==="rowNumber")return e.jsx("div",{className:"flex items-center justify-center text-[11px] text-slate-400 dark:text-slate-500 border-r border-slate-100 dark:border-slate-800 h-full font-mono shrink-0",style:{width:S.width},children:($==null?void 0:$.get(d.id))||"-"},S.key);if(S.key==="wbsNumber")return e.jsx("div",{className:"flex items-center justify-center text-[11px] text-slate-400 dark:text-slate-500 border-r border-slate-100 dark:border-slate-800 h-full font-mono shrink-0",style:{width:S.width},children:d.wbsNumber||"-"},S.key);if(S.key==="name"){const l=(d.level||0)*20;return e.jsxs("div",{className:`flex items-center h-full border-r border-slate-100 dark:border-slate-800 min-w-0 flex-1 ${A?"font-semibold":""} ${re?"text-red-700 dark:text-red-400":"text-slate-800 dark:text-slate-200"}`,style:{minWidth:S.width,paddingLeft:l+4},children:[e.jsx("div",{className:"w-5 flex-shrink-0 flex items-center justify-center",children:A?e.jsx("button",{onClick:i=>{i.stopPropagation(),R(d.id)},className:"p-0.5 hover:bg-slate-200 dark:hover:bg-slate-600 rounded",children:e.jsx(Ft,{expanded:!te})}):d.isMilestone?e.jsx("span",{className:"text-amber-500",children:e.jsx(Ht,{})}):null}),e.jsx(be,{value:d.name,field:"name",taskId:d.id,isEditing:oe,onStartEdit:F,onFinish:(i,T,V)=>i?N(i,T,V):F(null),className:`text-xs ${A?"font-semibold":""}`}),d.osOrderId&&k&&(()=>{const i=k.get(d.osOrderId),T=i?i.status==="done"?"bg-emerald-500":i.status==="in_progress"?"bg-blue-500":i.status==="blocked"?"bg-red-500":"bg-slate-400":"bg-slate-400";return e.jsx("span",{title:i?`OS: ${i.title} (${i.status})`:"OS vinculada",className:`ml-1 px-1 py-0 text-[9px] font-bold text-white rounded ${T} flex-shrink-0`,children:"OS"})})()]},S.key)}if(S.key==="durationDays"){const l=!d.estimatedHours,i=d.isMilestone?"0":`${d.durationDays||1}${l?"?":"d"}`;return e.jsx("div",{className:"flex items-center justify-center text-xs text-slate-600 dark:text-slate-400 border-r border-slate-100 dark:border-slate-800 h-full shrink-0",style:{width:S.width},children:!A&&!d.isMilestone?e.jsx(be,{value:d.durationDays,displayValue:i,field:"durationDays",taskId:d.id,isEditing:oe,onStartEdit:F,onFinish:(T,V,Z)=>T?N(T,V,parseInt(Z,10)||1):F(null),type:"number",className:"text-center"}):e.jsx("span",{className:"text-[11px]",children:d.isMilestone?"0":`${d.durationDays||0}d`})},S.key)}if(S.key==="estimatedHours"){const l=d.estimatedHours??(d.durationDays||0)*At;return e.jsx("div",{className:"flex items-center justify-center text-xs text-slate-600 dark:text-slate-400 border-r border-slate-100 dark:border-slate-800 h-full shrink-0",style:{width:S.width},children:A?e.jsx("span",{className:"text-[11px]",children:We(l)}):e.jsx(be,{value:parseFloat(l.toFixed(2)),displayValue:We(l),field:"estimatedHours",taskId:d.id,isEditing:oe,onStartEdit:F,onFinish:(i,T,V)=>i?N(i,T,parseFloat(V)||0):F(null),type:"number",className:"text-center"})},S.key)}if(S.key==="startDate"||S.key==="endDate")return e.jsx("div",{className:"flex items-center text-[10px] text-slate-600 dark:text-slate-400 border-r border-slate-100 dark:border-slate-800 h-full shrink-0",style:{width:S.width},children:A?e.jsx("span",{className:"px-1",children:X(d[S.key])}):e.jsx(be,{value:d[S.key],displayValue:X(d[S.key]),field:S.key,taskId:d.id,isEditing:oe,onStartEdit:F,onFinish:(l,i,T)=>l?N(l,i,T):F(null),type:"datetime-local"})},S.key);if(S.key==="progress")return e.jsx("div",{className:"flex items-center text-xs text-slate-600 dark:text-slate-400 border-r border-slate-100 dark:border-slate-800 h-full shrink-0",style:{width:S.width},children:e.jsx(Rt,{value:d.progress,taskId:d.id,onFinish:N})},S.key);if(S.key==="predecessors"){const l=Qe(d.predecessors,$||new Map);return e.jsx("div",{className:"flex items-center text-[11px] text-slate-600 dark:text-slate-400 border-r border-slate-100 dark:border-slate-800 h-full shrink-0",style:{width:S.width},children:A?e.jsx("span",{className:"px-1 truncate",children:l}):e.jsx(be,{value:l,field:"predecessors",taskId:d.id,isEditing:oe,onStartEdit:F,onFinish:(i,T,V)=>i?N(i,T,V):F(null),className:"text-[11px]"})},S.key)}return S.key==="assignedTo"?e.jsx("div",{className:"flex items-center text-xs text-slate-600 dark:text-slate-400 h-full shrink-0 border-r border-slate-100 dark:border-slate-800",style:{width:S.width},children:e.jsx(be,{value:d.assignedTo,field:"assignedTo",taskId:d.id,isEditing:oe,onStartEdit:F,onFinish:(l,i,T)=>l?N(l,i,T):F(null),type:"select",options:K})},S.key):S.key==="notes"?e.jsx("div",{className:"flex items-center justify-center text-xs text-slate-600 dark:text-slate-400 border-r border-slate-100 dark:border-slate-800 h-full shrink-0",style:{width:S.width},children:e.jsx(Bt,{notes:d.notes,attachments:d.attachments,taskId:d.id,onFinish:N})},S.key):null})},d.id)})})]})});function je(c,s){const g=new Date(c).getTime(),m=new Date(s).getTime();return Math.round((m-g)/(1e3*60*60*24))}function Vt(c,s){const g=new Date(c);return g.setDate(g.getDate()+s),g}function Gt(c){return c.toLocaleDateString("pt-BR",{month:"short",year:"numeric"})}function Xt(c){return c.toLocaleDateString("pt-BR",{month:"short"}).replace(".","")}function Yt(c){const s=c.getDay();return s===0||s===6}function Fe(c,s){return c.getFullYear()===s.getFullYear()&&c.getMonth()===s.getMonth()&&c.getDate()===s.getDate()}function _t(c,s){const g=[],{start:m,end:v}=c,f=new Date(m);if(s==="day"||s==="week")for(s==="week"&&f.setDate(f.getDate()-f.getDay());f<=v;)g.push({date:new Date(f),label:f.getDate().toString(),isWeekend:Yt(f)}),f.setDate(f.getDate()+1);else for(f.setDate(1);f<=v;){const M=new Date(f.getFullYear(),f.getMonth()+1,0).getDate();g.push({date:new Date(f),label:Gt(f),daysInCol:M}),f.setMonth(f.getMonth()+1)}return g}function qt(c){const s=[];let g=null;for(let m=0;m<c.length;m++){const v=c[m].date.getFullYear();!g||g.key!==v?(g={key:v,label:v.toString(),startIdx:m,count:1},s.push(g)):g.count++}return s}function Ut(c){const s=[];let g=null;for(let m=0;m<c.length;m++){const v=`${c[m].date.getFullYear()}-${c[m].date.getMonth()}`;!g||g.key!==v?(g={key:v,label:Xt(c[m].date),startIdx:m,count:1},s.push(g)):g.count++}return s}function Zt(c){const s=[];let g=null;for(let m=0;m<c.length;m++){const v=c[m].date,f=new Date(v);f.setDate(f.getDate()-f.getDay());const M=`${f.getFullYear()}-${f.getMonth()}-${f.getDate()}`;if(!g||g.key!==M){const p=f.toLocaleDateString("pt-BR",{month:"short"}).replace(".",""),a=`${p.charAt(0).toUpperCase()+p.slice(1)} ${f.getDate()}, '${f.getFullYear().toString().slice(2)}`;g={key:M,label:a,startIdx:m,count:1},s.push(g)}else g.count++}return s}function Qt({task:c,x:s,y:g,width:m,height:v,isSummary:f,isMilestone:M,isCritical:p,isSelected:a,onMouseDown:H}){const k=f?6:18,$=g+(v-k)/2,B=Math.max(0,c.progress/100*m);if(M){const I=s,L=g+v/2;return e.jsxs("g",{children:[e.jsx("polygon",{points:`${I},${L-7} ${I+7},${L} ${I},${L+7} ${I-7},${L}`,fill:p?"#ef4444":"#f59e0b",stroke:a?"#3b82f6":"#0f172a",strokeWidth:a?2:1,className:"cursor-pointer"}),e.jsx("text",{x:I+7+4,y:L+3,className:"text-[10px] fill-slate-600 dark:fill-slate-400",style:{fontSize:"9px"},children:c.name})]})}if(f){const W=p?"#ef4444":"#475569",I=g+v/2,L=5,R=Math.max(2,m);return e.jsxs("g",{className:"cursor-pointer",children:[e.jsx("line",{x1:s,y1:I,x2:s+R,y2:I,stroke:W,strokeWidth:2}),e.jsx("polyline",{points:`${s},${I-L} ${s},${I+L} ${s+5},${I}`,fill:"none",stroke:W,strokeWidth:2,strokeLinejoin:"round"}),e.jsx("polyline",{points:`${s+R},${I-L} ${s+R},${I+L} ${s+R-5},${I}`,fill:"none",stroke:W,strokeWidth:2,strokeLinejoin:"round"}),B>0&&e.jsx("line",{x1:s,y1:I+3,x2:s+B,y2:I+3,stroke:p?"#fca5a5":"#3b82f6",strokeWidth:2,strokeLinecap:"round"})]})}return e.jsxs("g",{className:"cursor-pointer",onMouseDown:H,children:[e.jsx("rect",{x:s+1,y:$+1,width:Math.max(4,m),height:k,fill:"rgba(0,0,0,0.06)",rx:2}),e.jsx("rect",{x:s,y:$,width:Math.max(4,m),height:k,fill:p?"#fecaca":c.color||"#93c5fd",stroke:a?"#2563eb":p?"#ef4444":"#60a5fa",strokeWidth:a?1.5:.5,rx:2}),B>0&&e.jsx("rect",{x:s,y:$,width:Math.min(B,Math.max(4,m)),height:k,fill:p?"#ef4444":"#3b82f6",rx:2}),c.progress===100&&m>20&&e.jsx("text",{x:s+Math.max(4,m)/2,y:$+k/2+3.5,textAnchor:"middle",className:"fill-white",style:{fontSize:"9px"},children:"âœ“"}),c.progress>0&&c.progress<100&&m>50&&e.jsxs("text",{x:s+Math.max(4,m)/2,y:$+k/2+3,textAnchor:"middle",className:"fill-white",style:{fontSize:"8px",fontWeight:600},children:[c.progress,"%"]}),e.jsx("rect",{x:s+Math.max(4,m)-4,y:$,width:8,height:k,fill:"transparent",className:"cursor-ew-resize","data-resize":"end"}),e.jsx("rect",{x:s-4,y:$,width:8,height:k,fill:"transparent",className:"cursor-ew-resize","data-resize":"start"})]})}function Jt({tasks:c,visibleTasks:s,getTaskPosition:g,criticalIds:m,showCriticalPath:v}){const f=[];for(const p of s)if(!(!p.predecessors||p.predecessors.length===0))for(const a of p.predecessors){const H=c.find(b=>b.id===a.taskId);if(!H)continue;const k=g(H.id),$=g(p.id);if(!k||!$)continue;const B=a.type||"FS",W=v&&m.has(p.id)&&m.has(H.id),I=W?"#ef4444":"#94a3b8",L=W?"url(#arrowhead-critical)":"url(#arrowhead)",R=k.y+k.height/2,F=$.y+$.height/2,N=Math.max(k.y+k.height,$.y+$.height)+10,z=k.x+k.width,j=k.x,E=$.x+$.width,P=$.x;let _;if(B==="FS")if(P>=z){const b=(z+P)/2;_=`M${z},${R} H${b} V${F} H${P}`}else{const b=P-10;_=`M${z},${R} H${z+10} V${N} H${b} V${F} H${P}`}else if(B==="SS"){const b=Math.min(j,P)-10;_=`M${j},${R} H${b} V${F} H${P}`}else if(B==="FF"){const b=Math.max(z,E)+10;_=`M${z},${R} H${b} V${F} H${E}`}else{const b=Math.min(j,E)-10;j<=E?_=`M${j},${R} H${b} V${F} H${E}`:_=`M${j},${R} H${j-10} V${N} H${E-10} V${F} H${E}`}f.push(e.jsx("g",{children:e.jsx("path",{d:_,fill:"none",stroke:I,strokeWidth:W?2:1.5,markerEnd:L})},`${H.id}-${p.id}`))}return e.jsx(e.Fragment,{children:f})}const es=n.forwardRef(function({tasks:s,allTasks:g,summaryIds:m,criticalIds:v,showCriticalPath:f,selectedTaskIds:M,dateRange:p,zoom:a,zoomConfig:H,rowHeight:k,onSelectTask:$,onBarDrag:B,onScroll:W},I){const L=n.useRef(null),R=n.useRef(null),[F,N]=n.useState(null),z=n.useRef(!1),j=H.colWidth,E=n.useMemo(()=>_t(p,a),[p,a]),P=n.useMemo(()=>a!=="month"?qt(E):null,[E,a]),_=n.useMemo(()=>a!=="month"?Ut(E):null,[E,a]),b=n.useMemo(()=>a==="week"?Zt(E):null,[E,a]),X=n.useMemo(()=>{if(a!=="month")return null;const l=[];let i=null;for(let T=0;T<E.length;T++){const V=E[T].date.getFullYear();!i||i.key!==V?(i={key:V,label:V.toString(),startIdx:T,count:1},l.push(i)):i.count++}return l},[E,a]),K=E.length*j,d=s.length*k,Y=new Date;Y.setHours(0,0,0,0);const A=n.useCallback(l=>{if(!l)return 0;const i=new Date(l.includes("T")?l:l+"T00:00:00"),T=je(p.start,i);if(a==="day"||a==="week")return T*j;{const V=je(p.start,p.end);return V>0?T/V*K:0}},[p,a,j,K]),te=n.useCallback(l=>{let i;if(a==="day"||a==="week")i=Math.round(l/j);else{const V=je(p.start,p.end);i=Math.round(l/K*V)}return Vt(p.start,i).toISOString().split("T")[0]},[p,a,j,K]);n.useEffect(()=>{if(z.current||s.length===0)return;const l=R.current;if(!l)return;const i=s.map(T=>T.startDate).filter(Boolean).sort()[0];if(i){const T=A(i);l.scrollLeft=Math.max(0,T-50),z.current=!0}},[s,A]);const ie=n.useCallback(l=>{const i=s.findIndex(Q=>Q.id===l);if(i===-1)return null;const T=s[i];if(!T.startDate)return null;const V=A(T.startDate),Z=T.endDate?A(T.endDate):V,J=Math.max(4,Z-V+j);return{x:V,y:i*k,width:J,height:k}},[s,A,j,k]),re=n.useMemo(()=>{const l=je(p.start,Y);if(a==="day"||a==="week")return l*j;const i=je(p.start,p.end);return i>0?l/i*K:0},[p,Y,a,j,K]),S=n.useCallback((l,i)=>{var fe;if(m.has(i.id)||i.isMilestone)return;l.preventDefault(),l.stopPropagation();const T=(fe=l.target.dataset)==null?void 0:fe.resize,V=l.clientX,Z=A(i.startDate),J=i.endDate?A(i.endDate):Z,Q=se=>{const ye=se.clientX-V;if(T==="end"){const de=Math.max(Z+j/2,J+ye);N({taskId:i.id,startDate:i.startDate,endDate:te(de)})}else if(T==="start"){const de=Math.min(J-j/2,Z+ye);N({taskId:i.id,startDate:te(de),endDate:i.endDate})}else{const de=Z+ye,q=J-Z;N({taskId:i.id,startDate:te(de),endDate:te(de+q)})}},ue=()=>{document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",ue),N(se=>(se&&(se.startDate!==i.startDate||se.endDate!==i.endDate)&&B(se.taskId,se.startDate,se.endDate),null))};document.addEventListener("mousemove",Q),document.addEventListener("mouseup",ue)},[A,te,j,m,B]),oe=()=>{if(a==="month")return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex",style:{height:k},children:X.map(l=>e.jsx("div",{className:"flex items-center justify-center border-r border-slate-200 dark:border-slate-700 text-[11px] font-semibold text-slate-600 dark:text-slate-400 uppercase",style:{width:l.count*j},children:l.label},l.key))}),e.jsx("div",{className:"flex",style:{height:k},children:E.map((l,i)=>e.jsx("div",{className:"flex items-center justify-center border-r border-slate-200 dark:border-slate-700 text-[10px] text-slate-500 dark:text-slate-400",style:{width:j},children:l.label},i))})]});if(a==="week"){const l=["D","S","T","Q","Q","S","S"];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex",style:{height:36},children:b.map(i=>e.jsx("div",{className:"flex items-center border-r border-b border-slate-300 dark:border-slate-600 text-[10px] font-semibold text-slate-600 dark:text-slate-400 pl-1.5 bg-slate-50 dark:bg-slate-800",style:{width:i.count*j},children:i.label},i.key))}),e.jsx("div",{className:"flex",style:{height:36},children:E.map((i,T)=>e.jsx("div",{className:`flex items-center justify-center border-r text-[10px] font-medium ${i.isWeekend?"bg-amber-50 dark:bg-amber-900/15 text-slate-400 dark:text-slate-500 border-slate-200 dark:border-slate-700":"text-slate-600 dark:text-slate-400 border-slate-200 dark:border-slate-700"} ${Fe(i.date,Y)?"bg-blue-100 dark:bg-blue-900/30 font-bold text-blue-600 dark:text-blue-400":""}`,style:{width:j},children:l[i.date.getDay()]},T))})]})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex",style:{height:18},children:P.map(l=>e.jsx("div",{className:"flex items-center justify-center border-r border-b border-slate-200 dark:border-slate-700 text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider bg-slate-50 dark:bg-slate-800",style:{width:l.count*j},children:l.label},l.key))}),e.jsx("div",{className:"flex",style:{height:26},children:_.map(l=>e.jsx("div",{className:"flex items-center justify-center border-r border-slate-200 dark:border-slate-700 text-[10px] font-semibold text-slate-600 dark:text-slate-400 uppercase",style:{width:l.count*j},children:l.label},l.key))}),e.jsx("div",{className:"flex",style:{height:28},children:E.map((l,i)=>e.jsx("div",{className:`flex items-center justify-center border-r border-slate-200 dark:border-slate-700 text-[10px] ${l.isWeekend?"bg-slate-200/50 dark:bg-slate-700/50 text-slate-400 dark:text-slate-500":"text-slate-500 dark:text-slate-400"} ${Fe(l.date,Y)?"bg-blue-100 dark:bg-blue-900/30 font-bold text-blue-600 dark:text-blue-400":""}`,style:{width:j},children:l.label},i))})]})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-shrink-0 border-b border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-800 overflow-hidden",style:{height:k*2},children:e.jsx("div",{style:{width:K,minWidth:"100%"},children:oe()})}),e.jsx("div",{ref:l=>{R.current=l,typeof I=="function"?I(l):I&&(I.current=l)},className:"flex-1 overflow-auto",onScroll:W,children:e.jsxs("svg",{ref:L,width:K,height:Math.max(d,200),className:"select-none",children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"6",refX:"8",refY:"3",orient:"auto",children:e.jsx("polygon",{points:"0 0, 8 3, 0 6",fill:"#94a3b8"})}),e.jsx("marker",{id:"arrowhead-critical",markerWidth:"8",markerHeight:"6",refX:"8",refY:"3",orient:"auto",children:e.jsx("polygon",{points:"0 0, 8 3, 0 6",fill:"#ef4444"})})]}),E.map((l,i)=>e.jsxs("g",{children:[e.jsx("line",{x1:i*j,y1:0,x2:i*j,y2:d,stroke:l.isWeekend?"#e2e8f0":"#f1f5f9",strokeWidth:.5,className:"dark:stroke-slate-800"}),l.isWeekend&&(a==="day"||a==="week")&&e.jsx("rect",{x:i*j,y:0,width:j,height:d,fill:"#fef3c7",className:"dark:fill-amber-900/10",opacity:.4})]},i)),s.map((l,i)=>e.jsx("line",{x1:0,y1:(i+1)*k,x2:K,y2:(i+1)*k,stroke:"#f1f5f9",strokeWidth:.5,className:"dark:stroke-slate-800"},i)),M.size>0&&s.map((l,i)=>M.has(l.id)?e.jsx("rect",{x:0,y:i*k,width:K,height:k,fill:"#eff6ff",className:"dark:fill-blue-900/10"},l.id):null),re>0&&re<K&&e.jsxs("g",{children:[e.jsx("line",{x1:re,y1:0,x2:re,y2:Math.max(d,200),stroke:"#ef4444",strokeWidth:2,strokeDasharray:"4,4"}),e.jsx("rect",{x:re-16,y:0,width:32,height:14,rx:3,fill:"#ef4444"}),e.jsx("text",{x:re,y:10,textAnchor:"middle",fill:"white",style:{fontSize:"8px",fontWeight:700},children:"HOJE"})]}),e.jsx(Jt,{tasks:g,visibleTasks:s,getTaskPosition:ie,criticalIds:v,showCriticalPath:f}),s.map((l,i)=>{if(!l.startDate)return null;const T=m.has(l.id),V=f&&v.has(l.id),Z=M.has(l.id),J=(F==null?void 0:F.taskId)===l.id?{...l,startDate:F.startDate,endDate:F.endDate}:l,Q=A(J.startDate),ue=J.endDate?A(J.endDate):Q,fe=l.isMilestone?0:Math.max(4,ue-Q+j);return e.jsx("g",{onClick:se=>$(l.id,se),children:e.jsx(Qt,{task:J,x:Q,y:i*k,width:fe,height:k,isSummary:T,isMilestone:l.isMilestone,isCritical:V,isSelected:Z,onMouseDown:se=>S(se,l)})},l.id)})]})})]})}),He=36,ts=460,ss=600,rs={day:{label:"Dia",colWidth:36,format:"day"},week:{label:"Semana",colWidth:22,format:"week"},month:{label:"Mes",colWidth:180,format:"month"}};function ns({project:c,tasks:s,teamMembers:g,osOrders:m=[],onCreateTask:v,onUpdateTask:f,onDeleteTask:M,invalidateEapTasks:p}){const{addToast:a}=ze(),H=Re(),k=n.useRef(null),$=n.useRef(null),B=n.useRef(null),W=n.useRef(!1),[I,L]=n.useState("week"),[R,F]=n.useState(new Set),[N,z]=n.useState(new Set),j=n.useRef(null),[E,P]=n.useState(null),[_,b]=n.useState(ss),[X,K]=n.useState(!1),[d,Y]=n.useState(!0),[A,te]=n.useState("all"),[ie,re]=n.useState(new Set(["wbsNumber"])),[S,oe]=n.useState(!1),l=n.useRef([]),i=n.useRef([]),T=50,V=n.useRef(!1),Z=n.useCallback(()=>{Je(c.id,l.current,i.current)},[c.id]),J=n.useCallback(async(t,r)=>{const o=[],u=[];let D=t;const y=r.map(h=>({...h}));for(;D;){const h=y.find(x=>x.id===D);if(!h)break;const w=Ee(D,y);if(!w)break;if(h.startDate!==w.startDate||h.endDate!==w.endDate||h.durationDays!==w.durationDays||h.progress!==w.progress||h.estimatedHours!==w.estimatedHours){const x={};for(const O of Object.keys(w))x[O]=h[O];o.push({taskId:D,before:x,after:{...w}}),await f(D,w,!0),u.push({taskId:D,before:x});const C=y.findIndex(O=>O.id===D);C!==-1&&Object.assign(y[C],w)}D=h.parentId}return{changes:o,completedOps:u}},[f]);n.useEffect(()=>{V.current||(V.current=!0,et(c.id).then(({undoStack:t,redoStack:r})=>{(t.length>0||r.length>0)&&(l.current=t,i.current=r)}))},[c.id]);const Q=n.useCallback(t=>{t.length!==0&&(l.current.push(t),l.current.length>T&&l.current.shift(),i.current=[],Z())},[Z]),ue=n.useCallback(async()=>{if(W.current)return;const t=l.current.pop();if(!t){a("Nada para desfazer","info");return}W.current=!0;try{const r=t.filter(o=>s.some(u=>u.id===o.taskId));for(let o=r.length-1;o>=0;o--){const{taskId:u,before:D}=r[o];await f(u,D,!0)}i.current.push(t),a("Desfeito (Ctrl+Z)","success")}catch(r){a("Erro ao desfazer: "+(r.message||"erro"),"error"),l.current.push(t)}finally{W.current=!1,p(),Z()}},[f,a,s,p,Z]),fe=n.useCallback(async()=>{if(W.current)return;const t=i.current.pop();if(!t){a("Nada para refazer","info");return}W.current=!0;try{const r=t.filter(o=>s.some(u=>u.id===o.taskId));for(const{taskId:o,after:u}of r)await f(o,u,!0);l.current.push(t),a("Refeito (Ctrl+Y)","success")}catch(r){a("Erro ao refazer: "+(r.message||"erro"),"error"),i.current.push(t)}finally{W.current=!1,p(),Z()}},[f,a,s,p,Z]),se=n.useCallback(()=>{var t;document.fullscreenElement?(document.exitFullscreen(),oe(!1)):((t=k.current)==null||t.requestFullscreen(),oe(!0))},[]);n.useEffect(()=>{const t=()=>oe(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]);const ye=n.useCallback(t=>{re(r=>{const o=new Set(r);return o.has(t)?o.delete(t):o.add(t),o})},[]),de=n.useMemo(()=>tt(s),[s]),q=n.useMemo(()=>st(de,R),[de,R]),$e=n.useCallback((t,r)=>{const o=(r==null?void 0:r.ctrlKey)||(r==null?void 0:r.metaKey);if((r==null?void 0:r.shiftKey)&&j.current){const D=q.findIndex(h=>h.id===j.current),y=q.findIndex(h=>h.id===t);if(D!==-1&&y!==-1){const h=Math.min(D,y),w=Math.max(D,y),x=new Set(q.slice(h,w+1).map(C=>C.id));z(o?C=>new Set([...C,...x]):x)}}else o?(z(D=>{const y=new Set(D);return y.has(t)?y.delete(t):y.add(t),y}),j.current=t):(z(new Set([t])),j.current=t)},[q]),le=n.useMemo(()=>{if(N.size===0)return null;for(const t of q)if(N.has(t.id))return t.id;return[...N][0]},[N,q]),Be=n.useCallback(t=>{z(new Set(t)),t.length>0&&(j.current=t[t.length-1])},[]),Ae=n.useMemo(()=>{const t=new Map;return q.forEach((r,o)=>t.set(r.id,o+1)),t},[q]),Ie=n.useMemo(()=>{const t=new Map;return q.forEach((r,o)=>t.set(o+1,r.id)),t},[q]),Le=n.useMemo(()=>A==="all"?q:q.filter(t=>t.assignedTo===A),[q,A]),ce=n.useMemo(()=>{const t=new Set;for(const r of s)r.parentId&&t.add(r.parentId);return t},[s]);n.useEffect(()=>{s.length!==0&&(async()=>{const t=[...ce].sort((u,D)=>{const y=s.find(w=>w.id===u),h=s.find(w=>w.id===D);return((h==null?void 0:h.level)||0)-((y==null?void 0:y.level)||0)}),r=s.map(u=>({...u}));let o=!1;for(const u of t){const D=r.find(h=>h.id===u);if(!D)continue;const y=Ee(u,r);if(y&&(D.startDate!==y.startDate||D.endDate!==y.endDate||D.durationDays!==y.durationDays)){await f(u,y,!0);const h=r.findIndex(w=>w.id===u);h!==-1&&Object.assign(r[h],y),o=!0}}o&&p()})()},[ce.size]);const Te=n.useMemo(()=>d?rt(s):new Set,[s,d]),Pe=n.useMemo(()=>{const t=new Date,r=s.flatMap(h=>[h.startDate,h.endDate]).filter(Boolean).map(h=>new Date(h.includes("T")?h:h+"T00:00:00")).filter(h=>!isNaN(h.getTime()));if(I==="month"){const h=t.getFullYear();return{start:new Date(h,0,1),end:new Date(h,11,31)}}if(r.length===0){const h=new Date(t.getFullYear(),t.getMonth(),1),w=new Date(t.getFullYear(),t.getMonth()+1,0);return{start:h,end:w}}const o=new Date(Math.min(...r)),u=new Date(Math.max(...r)),D=new Date(o.getFullYear(),o.getMonth(),1),y=new Date(u.getFullYear(),u.getMonth()+1,0);return{start:D,end:y}},[s,I]),Ke=n.useCallback(t=>{B.current&&(B.current.scrollTop=t.target.scrollTop)},[]),Ve=n.useCallback(t=>{$.current&&($.current.scrollTop=t.target.scrollTop)},[]),Ge=n.useCallback(t=>{t.preventDefault(),K(!0);const r=t.clientX,o=_,u=y=>{const h=y.clientX-r,w=Math.max(ts,o+h);b(w)},D=()=>{K(!1),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",D)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",D)},[_]),Xe=n.useCallback(t=>{F(r=>{const o=new Set(r);return o.has(t)?o.delete(t):o.add(t),o})},[]),we=n.useCallback(async(t=null)=>{const o=s.filter(C=>C.parentId===t).reduce((C,O)=>Math.max(C,O.sortOrder||0),0),u=t?s.find(C=>C.id===t):null,D=u?u.level+1:0,y=new Date().toISOString().split("T")[0]+"T08:00",h=ke(y.split("T")[0],1)+"T17:00",w={projectId:c.id,name:"Nova Tarefa",parentId:t,sortOrder:o+1,level:D,startDate:y,endDate:h,durationDays:1,estimatedHours:0,progress:0,assignedTo:"",predecessors:[]},x=await v(w);x&&(t&&N.has(t)||(z(new Set([x.id])),j.current=x.id),P({taskId:x.id,field:"name"}),t&&F(O=>{const U=new Set(O);return U.delete(t),U}))},[s,c.id,v,N]),Ye=n.useCallback(async()=>{const t=s.reduce((D,y)=>Math.max(D,y.sortOrder||0),0),r=new Date().toISOString().split("T")[0]+"T08:00",o={projectId:c.id,name:"Marco",parentId:null,sortOrder:t+1,level:0,isMilestone:!0,startDate:r,endDate:r,durationDays:0,progress:0,assignedTo:"",predecessors:[]},u=await v(o);u&&(z(new Set([u.id])),j.current=u.id,P({taskId:u.id,field:"name"}))},[s,c.id,v]),De=n.useMemo(()=>{const t=new Map;for(const r of m)t.set(r.id,r);return t},[m]),ve=n.useCallback(async()=>{if(N.size===0)return;const t=new Set,r=w=>{for(const x of s)x.parentId===w&&(t.add(x.id),r(x.id))};for(const w of N)t.add(w),r(w);let o=0;const u=[];for(const w of t){const x=s.find(O=>O.id===w);if(!(x!=null&&x.osOrderId))continue;const C=De.get(x.osOrderId);if(C&&(C.status==="available"||C.status==="pending"))try{await nt(C.id),o++}catch(O){u.push(w),a(`Falha ao remover OS "${C.title}": ${O.message||"erro"}. A tarefa sera mantida.`,"error")}}for(const w of u)t.delete(w);if(t.size===0){a("Nenhuma tarefa deletada (falha ao remover OS vinculadas)","warning");return}const D=[...t].sort((w,x)=>{const C=s.find(U=>U.id===w),O=s.find(U=>U.id===x);return((O==null?void 0:O.level)||0)-((C==null?void 0:C.level)||0)});for(const w of D)await M(w);o>0&&H.invalidateQueries({queryKey:ge.osOrders}),l.current=l.current.map(w=>w.filter(x=>!t.has(x.taskId))).filter(w=>w.length>0),i.current=i.current.map(w=>w.filter(x=>!t.has(x.taskId))).filter(w=>w.length>0),Z(),z(new Set),j.current=null;const y=t.size,h=y>1?`${y} tarefas excluidas${o>0?` (${o} OS removida${o>1?"s":""})`:""}${u.length>0?` (${u.length} mantida${u.length>1?"s":""} por erro na OS)`:""}`:`Tarefa excluida${o>0?` (${o} OS removida${o>1?"s":""})`:""}`;a(h,"success")},[N,s,De,M,a,H]),Ne=n.useCallback(async()=>{if(N.size===0||W.current)return;W.current=!0;const t=[];try{for(const r of q){if(!N.has(r.id))continue;const o=s.find(x=>x.id===r.id);if(!o)continue;const u=s.filter(x=>x.parentId===o.parentId).sort((x,C)=>x.sortOrder-C.sortOrder),D=u.findIndex(x=>x.id===o.id);if(D<=0)continue;const y=u[D-1],h={parentId:o.parentId,level:o.level},w={parentId:y.id,level:(y.level||0)+1};t.push({taskId:o.id,before:h,after:w}),await f(o.id,w,!0),F(x=>{const C=new Set(x);return C.delete(y.id),C})}t.length>0&&Q(t)}catch(r){a("Erro ao indentar: "+(r.message||"erro"),"error")}finally{W.current=!1,p()}},[N,q,s,f,Q,a,p]),Me=n.useCallback(async()=>{if(N.size===0||W.current)return;W.current=!0;const t=[];try{for(const r of q){if(!N.has(r.id))continue;const o=s.find(h=>h.id===r.id);if(!o||!o.parentId)continue;const u=s.find(h=>h.id===o.parentId);if(!u)continue;const D={parentId:o.parentId,level:o.level},y={parentId:u.parentId||null,level:Math.max(0,u.level||0)};t.push({taskId:o.id,before:D,after:y}),await f(o.id,y,!0)}t.length>0&&Q(t)}catch(r){a("Erro ao desindentar: "+(r.message||"erro"),"error")}finally{W.current=!1,p()}},[N,q,s,f,Q,a,p]),_e=n.useCallback(async(t,r,o)=>{const u=s.find(x=>x.id===t);if(!u)return;const D=[],y=[],h={};if(r==="predecessors"){const x=at(o,Ie);if(x.length>0&&ot(t,x,s)){a("Dependencia circular detectada! Esta predecessora criaria um ciclo.","error"),P(null);return}h.predecessors=x}else h[r]=o;if(r==="estimatedHours"){h.estimatedHours=o;const x=Math.max(1,Math.ceil(o/8));h.durationDays=x,u.startDate&&(h.endDate=ke(u.startDate,x))}else if(r==="startDate")if(u.endDate){const x=Se(o,u.endDate);h.durationDays=x,h.estimatedHours=Ce(o,u.endDate)}else u.durationDays>0&&(h.endDate=ke(o,u.durationDays));else if(r==="endDate"&&u.startDate){const x=Se(u.startDate,o);h.durationDays=x,h.estimatedHours=Ce(u.startDate,o)}else r==="durationDays"&&u.startDate&&(h.endDate=ke(u.startDate,o),h.estimatedHours=Ce(u.startDate,ke(u.startDate,o)));const w={};for(const x of Object.keys(h))w[x]=u[x];D.push({taskId:t,before:w,after:{...h}});try{if(await f(t,h),y.push({taskId:t,before:w}),u.parentId&&["startDate","endDate","durationDays","estimatedHours","progress"].includes(r)){const x=s.map(U=>U.id===t?{...U,...h}:U),{changes:C,completedOps:O}=await J(u.parentId,x);D.push(...C),y.push(...O)}if(["predecessors","startDate","endDate","durationDays","estimatedHours"].includes(r)){let x=s.map(G=>G.id===t?{...G,...h}:G);const C=Oe(x);for(const G of C){if(G.id===t&&r!=="predecessors")continue;const ee=s.find(ne=>ne.id===G.id);ee&&D.push({taskId:G.id,before:{startDate:ee.startDate,endDate:ee.endDate},after:{startDate:G.startDate,endDate:G.endDate}}),await f(G.id,{startDate:G.startDate,endDate:G.endDate},!0),ee&&y.push({taskId:G.id,before:{startDate:ee.startDate,endDate:ee.endDate}}),x=x.map(ne=>ne.id===G.id?{...ne,startDate:G.startDate,endDate:G.endDate}:ne)}const O=new Set;u.parentId&&O.add(u.parentId);for(const G of C){const ee=x.find(ne=>ne.id===G.id);ee!=null&&ee.parentId&&O.add(ee.parentId)}const U=[...O].sort((G,ee)=>{const ne=x.find(xe=>xe.id===G),he=x.find(xe=>xe.id===ee);return((he==null?void 0:he.level)||0)-((ne==null?void 0:ne.level)||0)}),me=new Set;for(const G of U){if(me.has(G))continue;const{changes:ee,completedOps:ne}=await J(G,x);for(const he of ee)me.add(he.taskId),x=x.map(xe=>xe.id===he.taskId?{...xe,...he.after}:xe);D.push(...ee),y.push(...ne)}p()}Q(D)}catch(x){if(y.length>0){a("Erro parcial â€” revertendo alteracoes...","warning");for(let C=y.length-1;C>=0;C--)try{await f(y[C].taskId,y[C].before,!0)}catch{}p()}a("Erro ao salvar: "+(x.message||"erro"),"error")}P(null)},[s,f,Ie,Q,a,p,J]),qe=n.useCallback(async(t,r,o)=>{const u=s.find(x=>x.id===t);if(!u)return;const D=[],y=[],h=Se(r,o),w={startDate:r,endDate:o,durationDays:h};D.push({taskId:t,before:{startDate:u.startDate,endDate:u.endDate,durationDays:u.durationDays},after:{...w}});try{if(await f(t,w),y.push({taskId:t,before:{startDate:u.startDate,endDate:u.endDate,durationDays:u.durationDays}}),u.parentId){const O=s.map(G=>G.id===t?{...G,...w}:G),{changes:U,completedOps:me}=await J(u.parentId,O);D.push(...U),y.push(...me)}const x=s.map(O=>O.id===t?{...O,...w}:O),C=Oe(x);for(const O of C)if(O.id!==t){const U=s.find(me=>me.id===O.id);U&&D.push({taskId:O.id,before:{startDate:U.startDate,endDate:U.endDate},after:{startDate:O.startDate,endDate:O.endDate}}),await f(O.id,{startDate:O.startDate,endDate:O.endDate},!0),U&&y.push({taskId:O.id,before:{startDate:U.startDate,endDate:U.endDate}})}(C.length>0||u.parentId)&&p(),Q(D)}catch(x){if(y.length>0){a("Erro parcial ao mover â€” revertendo...","warning");for(let C=y.length-1;C>=0;C--)try{await f(y[C].taskId,y[C].before,!0)}catch{}p()}a("Erro ao mover tarefa: "+(x.message||"erro"),"error")}},[s,f,Q,a,p,J]),Ue=n.useCallback(async()=>{if(!le)return;const t=s.find(r=>r.id===le);if(t){if(t.osOrderId){a("Esta tarefa ja possui uma OS vinculada","warning");return}if(t.level===0&&ce.has(t.id)){a("Tarefas raiz viram Projetos de OS. Selecione uma atividade (nivel 1+) para gerar OS.","warning");return}try{const r=await lt(t,c.name,s);if(r){H.invalidateQueries({queryKey:ge.osOrders}),H.invalidateQueries({queryKey:ge.osProjects}),H.invalidateQueries({queryKey:ge.eapTasks});const o=s.filter(D=>D.parentId===t.id).length,u=o>0?`OS "${r.title}" gerada com ${o} item(ns) no checklist`:`OS "${r.title}" gerada com sucesso`;a(u,"success")}else a("Erro ao gerar Ordem de Servico","error")}catch(r){a("Erro ao gerar OS: "+(r.message||"erro desconhecido"),"error")}}},[le,s,ce,c.name,a,H]),Ze=n.useCallback(async()=>{const{eapUpdates:t,osUpdates:r}=it(s,m);if(t.length===0&&r.length===0){a("Tudo sincronizado - nenhuma alteracao necessaria","info");return}try{let o=0,u=0;for(const{id:y,progress:h}of t)await f(y,{progress:h},!0),o++;for(const{id:y,status:h}of r)try{await dt(y,{status:h}),u++}catch(w){a(`Falha ao atualizar OS: ${w.message||"erro"}`,"error")}o>0&&p(),u>0&&H.invalidateQueries({queryKey:ge.osOrders});const D=[];o>0&&D.push(`${o} tarefa${o>1?"s":""} atualizada${o>1?"s":""}`),u>0&&D.push(`${u} OS atualizada${u>1?"s":""}`),a(`Sincronizado: ${D.join(", ")}`,"success")}catch(o){a("Erro ao sincronizar: "+(o.message||"erro"),"error"),p()}},[s,m,f,a,p,H]);return n.useEffect(()=>{const t=r=>{if((r.ctrlKey||r.metaKey)&&r.key==="z"&&!r.shiftKey){r.preventDefault(),ue();return}if((r.ctrlKey||r.metaKey)&&(r.key==="y"||r.key==="z"&&r.shiftKey)){r.preventDefault(),fe();return}if(!E){if((r.ctrlKey||r.metaKey)&&r.key==="a"){r.preventDefault(),z(new Set(q.map(o=>o.id)));return}if(r.key==="Escape"){z(new Set),j.current=null;return}if(r.key==="Delete"&&N.size>0)r.preventDefault(),ve();else if(r.key==="Insert"){r.preventDefault();const o=le?s.find(u=>u.id===le):null;we(o?o.parentId:null)}else r.key==="Tab"&&N.size>0&&(r.preventDefault(),r.shiftKey?Me():Ne())}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[E,N,q,le,s,ve,we,Me,Ne,ue,fe]),e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",ref:k,children:[e.jsx(Wt,{zoom:I,onZoomChange:L,onAddTask:()=>{const t=le?s.find(r=>r.id===le):null;we(t?t.parentId:null)},onAddSubTask:()=>we(le),onAddMilestone:Ye,onDeleteTask:ve,onIndent:Ne,onOutdent:Me,showCriticalPath:d,onToggleCriticalPath:()=>Y(t=>!t),hasSelection:N.size>0,selectionCount:N.size,teamMembers:g,filterAssignee:A,onFilterAssignee:te,onGenerateOS:Ue,onSyncProgress:Ze,selectedTask:le?s.find(t=>t.id===le):null,summaryIds:ce,hiddenColumns:ie,onToggleColumn:ye,isFullscreen:S,onToggleFullscreen:se}),e.jsxs("div",{className:"flex-1 flex min-h-0 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 border-r border-slate-200 dark:border-slate-700 flex flex-col",style:{width:_},children:e.jsx(Kt,{ref:$,tasks:Le,allTasks:s,summaryIds:ce,collapsedIds:R,selectedTaskIds:N,editingCell:E,criticalIds:Te,showCriticalPath:d,teamMembers:g,osMap:De,taskRowMap:Ae,hiddenColumns:ie,rowHeight:He,onSelectTask:$e,onDragSelect:Be,onToggleCollapse:Xe,onEditCell:P,onCellChange:_e,onScroll:Ke})}),e.jsx("div",{className:`w-1 cursor-col-resize hover:bg-blue-500 transition-colors flex-shrink-0 ${X?"bg-blue-500":"bg-transparent"}`,onMouseDown:Ge}),e.jsx("div",{className:"flex-1 min-w-0 flex flex-col",children:e.jsx(es,{ref:B,tasks:Le,allTasks:s,summaryIds:ce,criticalIds:Te,showCriticalPath:d,selectedTaskIds:N,dateRange:Pe,zoom:I,zoomConfig:rs[I],rowHeight:He,onSelectTask:$e,onBarDrag:qe,onScroll:Ve})})]}),e.jsxs("div",{className:"h-7 border-t border-slate-200 dark:border-slate-700 px-3 flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:[s.length," tarefa",s.length!==1?"s":""]}),s.length>0&&e.jsxs("span",{children:[Math.round(s.filter(t=>!ce.has(t.id)).reduce((t,r)=>t+(r.progress||0),0)/Math.max(1,s.filter(t=>!ce.has(t.id)).length)),"% concluido"]}),(()=>{const t=s.filter(r=>r.osOrderId).length;return t>0?e.jsxs("span",{className:"text-emerald-500",children:[t," OS vinculada",t>1?"s":""]}):null})(),N.size>1&&e.jsxs("span",{className:"text-blue-500 font-medium",children:[N.size," selecionadas"]}),d&&e.jsx("span",{className:"text-red-500",children:"Caminho Critico ativo"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{children:"Ctrl+Z: Desfazer | Ctrl+A: Selecionar Tudo | Ctrl+Click: Multi | Shift+Click: Range"})})]})]})}const as="Fyness EAP";function cs(){const{addToast:c}=ze(),s=Re(),{data:g=[],isLoading:m}=ct(),{data:v=[],isLoading:f}=ut(),{data:M=[]}=ft(),{data:p=[]}=ht(),a=xt(),H=mt(),k=pt(),$=bt(),[B,W]=n.useState({}),I=n.useRef(!1);n.useEffect(()=>{gt().then(j=>j&&W(j))},[]),n.useEffect(()=>{m||I.current||g.length===0&&(I.current=!0,a.mutateAsync({name:as,description:"",startDate:new Date().toISOString().split("T")[0],endDate:"",status:"active",color:"#3b82f6",createdBy:B.name||B.email||""}).finally(()=>{I.current=!1}))},[m,g.length]);const L=g[0]||null,R=L?v.filter(j=>j.projectId===L.id):[],F=n.useCallback(async j=>await H.mutateAsync(j),[H]),N=n.useCallback(async(j,E,P=!1)=>await k.mutateAsync({id:j,updates:E,skipInvalidation:P}),[k]),z=n.useCallback(async j=>{await $.mutateAsync(j)},[$]);return m||f||!L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:"-m-6 flex flex-col",style:{width:"calc(100% + 48px)",height:"calc(100% + 48px)"},children:e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(ns,{project:L,tasks:R,teamMembers:M,osOrders:p,onCreateTask:F,onUpdateTask:N,onDeleteTask:z,invalidateEapTasks:()=>s.invalidateQueries({queryKey:ge.eapTasks})})})})}export{cs as default};
